---
title: "Neanderthal ancestry through time"
author: "WRITE YOUR NAME HERE :)"
date: now
format: html
self-contained: true
---

# Basic processing

## Load required packages

```{r}
library(dplyr)
library(readr)
library(ggplot2)
```

## Read in data from the internet

```{r}
f4ratio <- read_tsv("https://tinyurl.com/simgen-f4ratio")
```

## Inspect the format of the table

```{r}
head(f4ratio)
```

```{r}
glimpse(f4ratio)
```

# Visualizing data

## Visualize the 10% of the data points

```{r}
f4ratio %>%
sample_frac(0.1) %>%
ggplot(aes(time, proportion)) +
  geom_point() +
  facet_wrap(~ statistic) +
  scale_x_reverse()
```

## Fit a smoothed out line through all parameter combinations

```{r}
f4ratio %>%
ggplot(aes(time, proportion, color = rate_eur2afr, group = rate_eur2afr)) +
  geom_line(stat = "smooth", se = FALSE) +
  facet_wrap(~ statistic) +
  scale_x_reverse() +
  geom_hline(yintercept = 0.03, color = "red", linetype = "dashed") +
  geom_hline(yintercept = 0, color = "blue", linetype = "dotted") +
  labs(x = "Neanderthal ancestry proportion",
       y = "years before present",
       title = "Expected Neanderthal ancestry trajectories",
       subtitle = "Results from a set of population genetic simulations") +
  guides(color = guide_legend("EUR -> AFR\nmigration")) +
  theme_minimal()
```

# Fitting a formal linear regression model

## Extract data for "direct" and "indirect" $f_4$-ratio

Filter data on the parameter setting of `rate_eur2afr == 0.2`, and
extract statistics for "direct" and "indirect" $f_4$-ratio statistics,
saving them in data frames `df_direct` and `df_indirect`:

```{r}
df_direct <- filter(f4ratio, rate_eur2afr == 0.2, statistic == "direct f4-ratio")
df_indirect <- filter(f4ratio, rate_eur2afr == 0.2, statistic == "indirect f4-ratio")
```

## Run linear regression on "direct" vs "indirect" $f_4$-ratio

Run a linear model using the `lm()` function (help can be found under
`?lm`) to find a p-value of the statistical significance between trajectories
of "direct" and "indirect" $f_4$-ratio estimates:

```{r}
# computing a linear regresion on df_direct and df_indirect data
lm_direct <- lm(proportion ~ time, data = df_direct)
lm_indirect <- lm(proportion ~ time, data = df_indirect)
```

Run `summary()` on both objects to get a p-value. Which statistic gives
a statistically significant decline of Neanderthal ancestry over time?

```{r}
# summary of the lm fit of the direct f4-ratio
summary(lm_direct)
```

```{r}
# summary of the lm fit of the indirect f4-ratio
summary(lm_indirect)
```

# Conclusions

# Conclusions

Here is where we could conclude what you found out in the course of the analysis.
Take home messages, pointers to follow up analyses in other later scripts and/or
Quarto notebooks, etc.

**My personal conclusion is that Quarto is amazing!**

# Session information

```{r}
sessionInfo()
```

