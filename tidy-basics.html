<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Basics of data science – Computational Population Genomics and Data Science in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./tidy-advanced.html" rel="next">
<link href="./r-bootcamp.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tidy-basics.html">Welcome to tidyverse</a></li><li class="breadcrumb-item"><a href="./tidy-basics.html"><span class="chapter-title">Basics of data science</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational Population Genomics and Data Science in R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./r-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R language</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-bootcamp.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">R bootcamp</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Welcome to tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidy-basics.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Basics of data science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidy-advanced.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Practical processing techniques</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidy-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Tidy data visualization</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Reproducible computing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repro-proj.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Structuring projects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repro-quarto.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Quarto reports and slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repro-cli.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Command-line scripts</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Spatial data science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial-sf.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Spatial data science</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Modeling fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./popgen-models.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Demographic models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./popgen-stats.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Tree-sequence statistics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Simulation-based inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference-afs.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><span class="math inline">\(N_e\)</span> inference with AFS</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Work in progress</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-thinking.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Algorithmic thinking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./popgen-nonspatial-pca.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Exploring PCA patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./popgen-spatial-pca.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Spatial PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./popgen-tracts-dating.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Admixture tracts and dating</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./popgen-selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Natural selection</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./handouts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Handouts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./handouts_slendr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction to <em>slendr</em></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Installation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./slides.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Slides</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#packages-introduced-in-this-session" id="toc-packages-introduced-in-this-session" class="nav-link active" data-scroll-target="#packages-introduced-in-this-session">Packages introduced in this session</a></li>
  <li><a href="#our-example-data-set" id="toc-our-example-data-set" class="nav-link" data-scroll-target="#our-example-data-set">Our example data set</a></li>
  <li><a href="#a-selection-of-data-frame-inspection-functions" id="toc-a-selection-of-data-frame-inspection-functions" class="nav-link" data-scroll-target="#a-selection-of-data-frame-inspection-functions">A selection of data-frame inspection functions</a></li>
  <li><a href="#exercise-1-exploring-new-data" id="toc-exercise-1-exploring-new-data" class="nav-link" data-scroll-target="#exercise-1-exploring-new-data">Exercise 1: Exploring new data</a></li>
  <li><a href="#exercise-2-selecting-columns" id="toc-exercise-2-selecting-columns" class="nav-link" data-scroll-target="#exercise-2-selecting-columns">Exercise 2: Selecting columns</a></li>
  <li><a href="#exercise-3-filtering-rows" id="toc-exercise-3-filtering-rows" class="nav-link" data-scroll-target="#exercise-3-filtering-rows">Exercise 3: Filtering rows</a></li>
  <li><a href="#exercise-4-the-pipe" id="toc-exercise-4-the-pipe" class="nav-link" data-scroll-target="#exercise-4-the-pipe">Exercise 4: The pipe <code>%&gt;%</code></a></li>
  <li><a href="#exercise-5-more-complex-conditions" id="toc-exercise-5-more-complex-conditions" class="nav-link" data-scroll-target="#exercise-5-more-complex-conditions">Exercise 5: More complex conditions</a></li>
  <li><a href="#exercise-6-dropping-columns" id="toc-exercise-6-dropping-columns" class="nav-link" data-scroll-target="#exercise-6-dropping-columns">Exercise 6: Dropping columns</a></li>
  <li><a href="#exercise-7-renaming-columns" id="toc-exercise-7-renaming-columns" class="nav-link" data-scroll-target="#exercise-7-renaming-columns">Exercise 7: Renaming columns</a></li>
  <li><a href="#exercise-8-reorganizing-columns" id="toc-exercise-8-reorganizing-columns" class="nav-link" data-scroll-target="#exercise-8-reorganizing-columns">Exercise 8: Reorganizing columns</a></li>
  <li><a href="#exercise-9-sorting-rows-based-on-columns" id="toc-exercise-9-sorting-rows-based-on-columns" class="nav-link" data-scroll-target="#exercise-9-sorting-rows-based-on-columns">Exercise 9: Sorting rows based on columns</a></li>
  <li><a href="#exercise-10-mutating-tables" id="toc-exercise-10-mutating-tables" class="nav-link" data-scroll-target="#exercise-10-mutating-tables">Exercise 10: Mutating tables</a>
  <ul class="collapse">
  <li><a href="#if_else" id="toc-if_else" class="nav-link" data-scroll-target="#if_else">1. <code>if_else()</code></a></li>
  <li><a href="#case_when" id="toc-case_when" class="nav-link" data-scroll-target="#case_when">2. <code>case_when()</code></a></li>
  </ul></li>
  <li><a href="#exercise-12-summarizing-tables" id="toc-exercise-12-summarizing-tables" class="nav-link" data-scroll-target="#exercise-12-summarizing-tables">Exercise 12: Summarizing tables</a>
  <ul class="collapse">
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by">1. <code>group_by()</code></a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize">2. <code>summarize()</code></a></li>
  <li><a href="#slice_-functions" id="toc-slice_-functions" class="nav-link" data-scroll-target="#slice_-functions"><code>slice_</code> functions</a></li>
  </ul></li>
  <li><a href="#exercise-13-writing-and-reading-tables" id="toc-exercise-13-writing-and-reading-tables" class="nav-link" data-scroll-target="#exercise-13-writing-and-reading-tables">Exercise 13: Writing (and reading) tables</a></li>
  <li><a href="#exercise-14-some-questions-about-the-data" id="toc-exercise-14-some-questions-about-the-data" class="nav-link" data-scroll-target="#exercise-14-some-questions-about-the-data">Exercise 14: Some questions about the data</a></li>
  <li><a href="#exercise-15-tidyverse-aware-functions" id="toc-exercise-15-tidyverse-aware-functions" class="nav-link" data-scroll-target="#exercise-15-tidyverse-aware-functions">Exercise 15: <em>tidyverse</em>-aware functions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tidy-basics.html">Welcome to tidyverse</a></li><li class="breadcrumb-item"><a href="./tidy-basics.html"><span class="chapter-title">Basics of data science</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Basics of data science</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="packages-introduced-in-this-session" class="level2">
<h2 class="anchored" data-anchor-id="packages-introduced-in-this-session">Packages introduced in this session</h2>
<p>Before we begin, let’s introduce the a couple of crucial parts of the <em>tidyverse</em> ecosystem, which we will be using extensively during exercises in this chapter.</p>
<ol type="1">
<li><p><a href="https://dplyr.tidyverse.org"><em>dplyr</em></a> is a centerpiece of the entire R data science universe, providing important functions for data manipulation, data summarization, and filtering of tabular data;</p></li>
<li><p><a href="https://tidyr.tidyverse.org"><em>tidyr</em></a> helps us morph untidy data into tidy data frames;</p></li>
<li><p><a href="https://readr.tidyverse.org"><em>readr</em></a> provides very functions for reading (and writing) tabular data. Think of it as a set of better alternatives to base R functions such as <code>read.table()</code>, etc. (Another very useful package is <a href="https://readxl.tidyverse.org"><em>readxl</em></a> which is useful for working with Excel data).</p></li>
</ol>
<p><strong>Every single script you will be writing in this session will begin with these three lines of code.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="our-example-data-set" class="level2">
<h2 class="anchored" data-anchor-id="our-example-data-set">Our example data set</h2>
<p>Let’s also introduce a second star in this session, our example data set. The following command will read a metadata table with information about individuals published in a recent aDNA paper on the history or the Holocene in West Eurasia, dubbed “MesoNeo” (<a href="https://www.nature.com/articles/s41586-023-06865-0">reference</a>). Feel free to skim the paper to get an idea. If you work with anything related to human history, you’ll become closely familiar with this study.</p>
<p><strong>We use the <code>read_tsv()</code> function (from the above-mentioned <em>readr</em> package) and store it in a variable <code>df</code>.</strong> Everything in these exercises will revolve around working with this data because it represents an excellent example of this kind of metadata table you will find across the entirety of computational population genomics. (Yes, this function is quite magical – it can read stuff from a file stored on the internet. If you’re curious about the file itself, just paste the URL address in your browser.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"https://tinyurl.com/simgen-metadata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><strong>In addition to the brief overview from the slides for this exercise session and looking up documentation to functions via R’s <code>?</code> help system, I highly encourage you to refer to <a href="https://r4ds.hadley.nz/data-transform.html">this</a> chapter of the <em>R for Data Science</em> text book.</strong> I keep this book at hand every time I work with R.</p>
<hr>
<p><strong>Create a new R script in RStudio, (<code>File</code> <code>-&gt;</code> <code>New file</code> <code>-&gt;</code> <code>R Script</code>) and save it somewhere on your computer as <code>tidy-basics.R</code> (<code>File</code> <code>-&gt;</code> <code>Save</code>). Put the <code>library()</code> calls and the <code>read_tsv()</code> command above in this script, and let’s get started!</strong></p>
<hr>
</section>
<section id="a-selection-of-data-frame-inspection-functions" class="level2">
<h2 class="anchored" data-anchor-id="a-selection-of-data-frame-inspection-functions">A selection of data-frame inspection functions</h2>
<p>Whenever you get a new source of data, like a table from a collaborator, data sheet downloaded from supplementary materials of a paper (our situation in this session!), you need to familiarize yourself with it before you do anything else.</p>
<p>Here is a list of functions that you will be using constantly when doing data science to answer the following basic questions about your data.</p>
<p><strong>Note:</strong> Use this list as a cheatsheet of sorts! Also, <strong>don’t forget to use the <code>?function</code> command in the R console to look up the documentation to see the possibilities for options and additional features, or even just to refresh your memory. Every time I look up the <code>?</code> help for a function I’ve been using for decade, I always learn new tricks.</strong></p>
<ol type="1">
<li><p><em>“How many observations (rows) and variables (columns) does my data have?”</em> – <code>nrow()</code>, <code>ncol()</code></p></li>
<li><p><em>“What variable names (columns) am I going to be working with?”</em> – <code>colnames()</code></p></li>
<li><p><em>“What data types (numbers, strings, logicals, etc.) does it contain?”</em> – <code>str()</code>, or better, <code>glimpse()</code></p></li>
<li><p><em>“How can I take a quick look at a subset of the data (first/last couple of rows)?”</em> – <code>head()</code>, <code>tail()</code></p></li>
<li><p><em>“For a specific variable column, what is the distribution of values I can expect in that column?”</em> – <code>table()</code> for “categorical types” (types which take only a couple of discrete values), <code>summary()</code> for “numeric types”, <code>min()</code>, <code>max()</code>, <code>which.min()</code>, <code>which.max()</code></p></li>
</ol>
<hr>
<p><strong>Before we move on, note that when you type <code>df</code> into your R console, you will see a slightly different format of the output than when we worked with plain R data frames in the previous chapter. This format of data frame data is called a <a href="https://tibble.tidyverse.org">“tibble”</a> and represents <em>tidyverse</em>’s more user friendly and modern take on data frames. For almost all practical purposes, from now on, we’ll be talking about <em>tibbles</em> as data frames.</strong></p>
<hr>
</section>
<section id="exercise-1-exploring-new-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1-exploring-new-data">Exercise 1: Exploring new data</h2>
<ol type="1">
<li><strong>Inspect the <code>df</code> metadata table using the functions above, and try to answer the following questions using the functions from the list above (you should decide which will be appropriate for which question). Before you use one of these functions for the first time, take a moment to skim through its <code>?function_name</code>.</strong></li>
</ol>
<p><strong>How many individuals do we have metadata for?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Number of rows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4072</code></pre>
</div>
</div>
<p>Number of <code>unique()</code> sample IDs (this should ideally always give the same number, but there’s never enough sanity checks in data science):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(df<span class="sc">$</span>sampleId))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4072</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>What variables (i.e., columns) do we have in our data?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Column names function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "sampleId"     "popId"        "site"         "country"      "region"      
 [6] "continent"    "groupLabel"   "groupAge"     "flag"         "latitude"    
[11] "longitude"    "dataSource"   "age14C"       "ageHigh"      "ageLow"      
[16] "ageAverage"   "datingSource" "coverage"     "sex"          "hgMT"        
[21] "gpAvg"        "ageRaw"       "hgYMajor"     "hgYMinor"    </code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>What data types (numbers, strings, logicals, etc.) are our variables of?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I tend to use <code>str()</code> because I’m old and very used to it, but <code>glimpse()</code> is new and better. You can see the data types in the second column after <code>:</code>. (“chr” – character, “num” – numeric, etc., “dbl” – double).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [4,072 × 24] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ sampleId    : chr [1:4072] "NA18486" "NA18488" "NA18489" "NA18498" ...
 $ popId       : chr [1:4072] "YRI" "YRI" "YRI" "YRI" ...
 $ site        : chr [1:4072] NA NA NA NA ...
 $ country     : chr [1:4072] "Nigeria" "Nigeria" "Nigeria" "Nigeria" ...
 $ region      : chr [1:4072] "WestAfrica" "WestAfrica" "WestAfrica" "WestAfrica" ...
 $ continent   : chr [1:4072] "Africa" "Africa" "Africa" "Africa" ...
 $ groupLabel  : chr [1:4072] "YRI" "YRI" "YRI" "YRI" ...
 $ groupAge    : chr [1:4072] "Modern" "Modern" "Modern" "Modern" ...
 $ flag        : chr [1:4072] "0" "0" "0" "0" ...
 $ latitude    : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ longitude   : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ dataSource  : chr [1:4072] "1000g" "1000g" "1000g" "1000g" ...
 $ age14C      : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ ageHigh     : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ ageLow      : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ ageAverage  : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ datingSource: chr [1:4072] NA NA NA NA ...
 $ coverage    : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ sex         : chr [1:4072] "XY" "XX" "XX" "XY" ...
 $ hgMT        : chr [1:4072] NA NA NA NA ...
 $ gpAvg       : num [1:4072] NA NA NA NA NA NA NA NA NA NA ...
 $ ageRaw      : chr [1:4072] NA NA NA NA ...
 $ hgYMajor    : chr [1:4072] NA NA NA NA ...
 $ hgYMinor    : chr [1:4072] NA NA NA NA ...
 - attr(*, "spec")=
  .. cols(
  ..   sampleId = col_character(),
  ..   popId = col_character(),
  ..   site = col_character(),
  ..   country = col_character(),
  ..   region = col_character(),
  ..   continent = col_character(),
  ..   groupLabel = col_character(),
  ..   groupAge = col_character(),
  ..   flag = col_character(),
  ..   latitude = col_double(),
  ..   longitude = col_double(),
  ..   dataSource = col_character(),
  ..   age14C = col_double(),
  ..   ageHigh = col_double(),
  ..   ageLow = col_double(),
  ..   ageAverage = col_double(),
  ..   datingSource = col_character(),
  ..   coverage = col_double(),
  ..   sex = col_character(),
  ..   hgMT = col_character(),
  ..   gpAvg = col_double(),
  ..   ageRaw = col_character(),
  ..   hgYMajor = col_character(),
  ..   hgYMinor = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,072
Columns: 24
$ sampleId     &lt;chr&gt; "NA18486", "NA18488", "NA18489", "NA18498", "NA18499", "N…
$ popId        &lt;chr&gt; "YRI", "YRI", "YRI", "YRI", "YRI", "YRI", "YRI", "YRI", "…
$ site         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ country      &lt;chr&gt; "Nigeria", "Nigeria", "Nigeria", "Nigeria", "Nigeria", "N…
$ region       &lt;chr&gt; "WestAfrica", "WestAfrica", "WestAfrica", "WestAfrica", "…
$ continent    &lt;chr&gt; "Africa", "Africa", "Africa", "Africa", "Africa", "Africa…
$ groupLabel   &lt;chr&gt; "YRI", "YRI", "YRI", "YRI", "YRI", "YRI", "YRI", "YRI", "…
$ groupAge     &lt;chr&gt; "Modern", "Modern", "Modern", "Modern", "Modern", "Modern…
$ flag         &lt;chr&gt; "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0…
$ latitude     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ longitude    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ dataSource   &lt;chr&gt; "1000g", "1000g", "1000g", "1000g", "1000g", "1000g", "10…
$ age14C       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ ageHigh      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ ageLow       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ ageAverage   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ datingSource &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ coverage     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ sex          &lt;chr&gt; "XY", "XX", "XX", "XY", "XX", "XY", "XX", "XY", "XX", "XY…
$ hgMT         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ gpAvg        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ ageRaw       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ hgYMajor     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ hgYMinor     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>What are the variables we have that describe the ages (maybe look at those which have “age” in their name)? Which one would you use to get information about the ages of most individuals and why? What is the distribution of dates of aDNA individuals?</strong></p>
<p><strong>Hint:</strong> Remember that for a column/vector <code>df$&lt;variable&gt;</code>, <code>is.na(df$&lt;variable&gt;)</code> gives you <code>TRUE</code> for each <code>NA</code> element in that column variable, and <code>sum(is.na(df$&lt;variable&gt;))</code> counts the number of <code>NA</code>. Alternatively, <code>mean(is.na(df$&lt;variable&gt;))</code> counts the proportion of <code>NA</code> values!</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>From <code>colnames(df)</code> above we see a number of columns which seem to have something todo with “age”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>columns <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "sampleId"     "popId"        "site"         "country"      "region"      
 [6] "continent"    "groupLabel"   "groupAge"     "flag"         "latitude"    
[11] "longitude"    "dataSource"   "age14C"       "ageHigh"      "ageLow"      
[16] "ageAverage"   "datingSource" "coverage"     "sex"          "hgMT"        
[21] "gpAvg"        "ageRaw"       "hgYMajor"     "hgYMinor"    </code></pre>
</div>
</div>
<p>We can get those precisely using this trick (don’t worry about this weird command, I’m using it to show you the relevant columns – I’m happy to explain if you’re interested!):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">"^age.*|^.*Age$"</span>, columns, <span class="at">value =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "groupAge"   "age14C"     "ageHigh"    "ageLow"     "ageAverage"
[6] "ageRaw"    </code></pre>
</div>
</div>
<p>Now let’s take a look at the values available in each of them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>age14C))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2119352</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>ageHigh))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.404224</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>ageLow))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.404224</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>ageAverage))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4093811</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>ageRaw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09675835</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>groupAge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Modern"  "Ancient" "Archaic"</code></pre>
</div>
</div>
<p>Interesting, it looks like the <code>ageAverage</code> variable has the highest proportion of non-<code>NA</code> values at about 40.94%. We also seem to have another column, <code>groupAge</code> which clusters individuals into three groups. We’ll stick to these two variables whenever we have a question regarding a date of an individual.</p>
</div>
</div>
</div>
<p><strong>How many ancient individuals do we have? How many “modern” (i.e., present-day humans) individuals?</strong></p>
<p><strong>Hint:</strong> Use the fact that for any vector (and <code>df$groupAge</code> is a vector, remember!), we can get the number of elements of that vector matching a certain value by applying the <code>sum()</code> function on a “conditional” expression, like <code>df$groupAge == "Ancient"</code> (which, on its own, gives <code>TRUE</code> / <code>FALSE</code> vector). In other words, in a <code>TRUE</code> / <code>FALSE</code> vector, each <code>TRUE</code> represents 1, and each <code>FALSE</code> represents 0. Obviously then, summing up such vector simply adds all the 1s together.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Get logical vector of which individual’s <code>groupAge</code> value is equal to “Ancient”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>which_ancient <span class="ot">&lt;-</span> df<span class="sc">$</span>groupAge <span class="sc">==</span> <span class="st">"Ancient"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Indeed this gave us a logical vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(which_ancient)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>Which is equivalent to 1 and 0 vector under the hood:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.integer</span>(which_ancient))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0 0 0</code></pre>
</div>
</div>
<p>And this means we can sum it like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(which_ancient)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1664</code></pre>
</div>
</div>
<p>We can do the same for “Modern” and “Archaic” individuals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>which_modern <span class="ot">&lt;-</span> df<span class="sc">$</span>groupAge <span class="sc">==</span> <span class="st">"Modern"</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(which_modern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2405</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>which_archaic <span class="ot">&lt;-</span> df<span class="sc">$</span>groupAge <span class="sc">==</span> <span class="st">"Archaic"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(which_archaic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Who are the mysterious “Archaic” individuals? What are their names (<code>sampleId</code>) and which publications they come frome (<code>dataSource</code>)?</strong></p>
<p><strong>Hint:</strong> We need to <em>filter</em> our table down to rows which have <code>groupAge == "Archaic"</code>. This is an indexing operation which you learned about in the R bootcamp session! Remember that data frames can be indexed into along two dimensions: rows and columns. You want to filter by the rows here using a logical vector obtained by <code>df$groupAge == "Archaic"</code>.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Again, this gets us a logical vector which has <code>TRUE</code> for each element corresponding to an “Archaic” individual (whoever that might be):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>which_archaic <span class="ot">&lt;-</span> df<span class="sc">$</span>groupAge <span class="sc">==</span> <span class="st">"Archaic"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(which_archaic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>And we can then use this vector as an index into our overall data frame, just like we learned in the bootcamp session:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>archaic_df <span class="ot">&lt;-</span> df[which_archaic, ]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>archaic_df<span class="sc">$</span>sampleId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Vindija33.19"    "AltaiNeandertal" "Denisova"       </code></pre>
</div>
</div>
<p>Our mysterious “Archaic” individuals are two Neanderthals and a Denisovan!</p>
<p>Here are the publications:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>archaic_df<span class="sc">$</span>dataSource</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Prufer_Science_2017" "Prufer_Nature_2014"  "Pruefer_2017"       </code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Do we have geographical information in our metadata? Maybe countries or geographical coordinates (or even both)? Which countries do we have individuals from? (We’ll talk about spatial data science later in detail, so let’s interpret whatever geographical variable columns we have in our data frame <code>df</code> as any other numerical or string column variable.)</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Looking at <code>colnames(df)</code> we have a number of columns which have something to do with geography: <code>country</code>, <code>region</code>, and also the traditional <a href="https://en.wikipedia.org/wiki/Geographic_coordinate_system#Latitude_and_longitude"><code>longitude</code> and <code>latitude</code> coordinates</a>.</p>
<p>How can we get an idea about the distribution of countries? <code>table()</code> counts the number of elements in a vector (basically, a histogram without plotting it), <code>sort()</code> then sorts those elements for easier reading:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(df<span class="sc">$</span>country), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
         India          China         Russia          Italy        Nigeria 
           394            308            285            256            207 
       Denmark         Sweden             UK          Spain         Gambia 
           184            174            167            132            114 
           USA        Vietnam          Japan     PuertoRico        Finland 
           108            108            107            104            102 
         Kenya       Barbados       Pakistan       Colombia           Peru 
            98             96             96             94             91 
   SierraLeone         Mexico     Kazakhstan        Estonia        Ukraine 
            85             67             64             60             60 
        Poland         France         Norway        Hungary        Iceland 
            56             54             42             41             40 
    Kyrgyzstan         Turkey        Lebanon       Portugal        Ireland 
            39             22             19             18             16 
        Faroes        Germany      Greenland        Moldova  CzechRepublic 
            15             12             11             10              9 
  South Africa           Iran         Latvia        Romania        Armenia 
             9              8              7              7              6 
        Canada         Serbia      Argentina         Brazil Canary Islands 
             6              6              5              5              5 
      Mongolia          Chile        Georgia           Laos       Malaysia 
             5              4              4              4              4 
      Thailand   Turkmenistan         Greece       Cameroon      Indonesia 
             4              4              3              2              2 
       Croatia       Ethiopia      Lithuania     Luxembourg    Philippines 
             1              1              1              1              1 
      Slovakia    Switzerland 
             1              1 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(df<span class="sc">$</span>region), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      NorthernEurope            SouthAsia             EastAsia 
                 635                  489                  420 
      SouthernEurope           WestAfrica         NorthAmerica 
                 409                  406                  382 
CentralEasternEurope        WesternEurope         SouthAmerica 
                 330                  251                  199 
           NorthAsia        SouthEastAsia          CentralAsia 
                 146                  124                  107 
          EastAfrica          WesternAsia          SouthAfrica 
                  99                   59                    9 
         NorthAfrica        CentralAfrica 
                   5                    2 </code></pre>
</div>
</div>
<p>We will ignore <code>longitude</code> and <code>latitude</code> for now, because they are most useful in truly geographical data analysis setting (which we will delve into a bit later).</p>
</div>
</div>
</div>
<p><strong>What is the source of the sequences in our data set? Does it look like they all come from a single study?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It looks like we have a <code>dataSource</code> column which, from the <code>glimpse()</code> result above is a character vector (a vector of “strings”). This suggests that it represents discrete categories, so let’s use the <code>table()</code> &amp; <code>sort()</code> combo again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(df<span class="sc">$</span>dataSource), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                      1000g 
                                       2405 
                      Margyaran_2020_Nature 
                                        376 
                                  thisStudy 
                                        318 
                       Antonio_2019_Science 
                                        134 
                       Damgaard_2018_Nature 
                                        131 
                      Damgaard_Science_2018 
                                         68 
                      Allentoft_Nature_2015 
                                         64 
                           Brunel_PNAS_2020 
                                         49 
                        Scheib_Science_2018 
                                         42 
            Krzewinska_ScienceAdvances_2018 
                                         28 
                         Sikora_Nature_2019 
                                         28 
               Ebenesersdottir_Science_2018 
                                         25 
                        McColl_Science_2018 
                                         25 
                        Schroeder_PNAS_2019 
                                         24 
                   Saag_CurrentBiology_2019 
                                         22 
                  Jarve_CurrentBiology_2019 
                                         21 
                    SanchezQuinto_PNAS_2019 
                                         21 
           Fernandes_ScientificReports_2018 
                                         17 
                   MorenoMayar_Science_2018 
                                         17 
             Krzewinska_CurrentBiology_2018 
                                         16 
                            Haber_AJHG_2019 
                                         14 
               Martiniano_PLoSGenetics_2017 
                                         12 
                 Malmstrom_ProcBiolSci_2019 
                                         11 
           Amorim_NatureCommunications_2018 
                                         10 
          Brace_NatureEcologyEvolution_2019 
                                         10 
        Schiffels_NatureCommunications_2016 
                                         10 
                       Valdiosera_PNAS_2018 
                                         10 
                         Veeramah_PNAS_2018 
                                         10 
            Gamba_NatureCommunications_2014 
                                          9 
       Martiniano_NatureCommunications_2016 
                                          9 
                      Raghavan_Science_2015 
                                          9 
                  Jones_CurrentBiology_2017 
                                          8 
                   Gunther_PLoSBiology_2018 
                                          7 
                 Kilinc_CurrentBiology_2016 
                                          7 
                   Ning_CurrentBiology_2019 
                                          7 
         GonzalesFortes_CurrentBiology_2017 
                                          6 
                 Lindo_ScienceAdvances_2018 
                                          6 
                    Schlebusch_Science_2017 
                                          6 
                            Haber_AJHG_2017 
                                          5 
                        Hofmanova_PNAS_2016 
                                          5 
                      Lazaridis_Nature_2014 
                                          5 
        RodriguezVarela_CurrentBiology_2017 
                                          5 
                     Broushaki_Science_2016 
                                          4 
                          Cassidy_PNAS_2016 
                                          4 
          GonzalesFortes_ProcRoyalSocB_2019 
                                          4 
                   Saag_CurrentBiology_2017 
                                          4 
                        Sikora_Science_2017 
                                          4 
            Jones_NatureCommunications_2015 
                                          3 
         Kashuba_CommunicationsBiology_2019 
                                          3 
                         Skoglund_Cell_2017 
                                          3 
                      Skoglund_Science_2014 
                                          3 
                      Allentoft_2015_Nature 
                                          2 
KanzawaKiriyama_AnthropologicalScience_2019 
                                          2 
                         Lipson_Nature_2020 
                                          2 
      Unterlander_NatureCommunications_2017 
                                          2 
                             Fu_Nature_2014 
                                          1 
                             Fu_Nature_2016 
                                          1 
               GallegoLlorente_Science_2015 
                                          1 
     GallegoLlorente_ScientificReports_2016 
                                          1 
                            gjerrild_inPrep 
                                          1 
                          Gunther_PNAS_2015 
                                          1 
           Jensen_NatureCommunications_2019 
                                          1 
                    MorenoMayar_Nature_2017 
                                          1 
                         Olalde_Nature_2014 
                                          1 
                             OlaldeMBE_2015 
                                          1 
                  Omrak_CurrentBiology_2016 
                                          1 
                               Pruefer_2017 
                                          1 
                         Prufer_Nature_2014 
                                          1 
                        Prufer_Science_2017 
                                          1 
                       Raghavan_Nature_2013 
                                          1 
                      Rasmussen_Nature_2010 
                                          1 
                      Rasmussen_Nature_2014 
                                          1 
                      Rasmussen_Nature_2015 
                                          1 
                Seguin-Orlando_Science_2014 
                                          1 
                                  st_inPrep 
                                          1 </code></pre>
</div>
</div>
<p>OK, it looks like we have most individuals (2504) from the <a href="http://www.internationalgenome.org">1000 genomes project</a>, we have 318 samples from <a href="https://www.nature.com/articles/s41586-023-06865-0">“this study”</a>, and then a bunch of individuals from a wide range of other publications. This is great because it allows us to refer individual specific results we might obtain later to the respective publications!</p>
</div>
</div>
</div>
<p><strong>What’s the distribution of coverage of the samples? Compute the <code>mean()</code> and other <code>summary()</code> statistics on the coverage information. Why doesn’t the <code>mean()</code> function work when you run it on the vector of numbers in the <code>coverage</code> column (i.e, <code>df$coverage</code>, use <code>?mean</code> to find the solution). Which individuals have missing coverage? Finally, use the <code>hist()</code> function to visualize this information to get a rough idea about the data.</strong></p>
<p>These are all basic questions which you will be asking yourself <em>every time</em> you read a new table into R. It might not always be coverage, but you will have to do this to familiarize yourself with the data and understand its potential issues! **Always keep an eye on strange outliers, missing data <code>NA</code>, anything suspicious. Never take any data for granted (that applies both to data from any third parties, but even to your own data sets!).</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Mean gives us <code>NA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>coverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>This is because computing the mean from a vector containing <code>NA</code> values is not a sensible operation – should we remove the <code>NA</code> values? It’s impossible to say in general, because that would depend on the nature of our data. Sometimes, encountering <code>NA</code> indicates a problem, so we can’t just ignore it. In situation when this is OK, there’s a argument which changes the default behavior and removes the <code>NA</code> elements before computing the mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>coverage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.623767</code></pre>
</div>
</div>
<p>Summary takes care of the issue by reporting the number of <code>NA</code> values explicitly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df<span class="sc">$</span>coverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
 0.0124  0.2668  0.7824  1.6238  1.5082 58.8661    2405 </code></pre>
</div>
</div>
<p>We can see that the coverage information is missing for 2405 individuals, which is the number of individuals in the (present-day) 1000 Genomes Project data. So it makes sense, we only have coverage for the lower-coverage aDNA samples, but for present-day individuals (who have imputed genomes), the coverage does not even make sense here.</p>
<p>Let’s plot the coverage values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>coverage, <span class="at">breaks =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tidy-basics_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>Who is the oldest individuals in our data set? Who has the highest coverage? Who has the lowest coverage?</strong></p>
<p><strong>Hint:</strong> Use functions <code>min()</code>, <code>max()</code> or <code>which.min()</code>, <code>which.max()</code>. When would you use each of the pair of functions? Look up their <code>?help</code> to understand what they do and how to use them in this context.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>which.max()</code> reports the <em>index</em> (in this case, the row number) of the maximum value in a vector (in this case, a column vector):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(df<span class="sc">$</span>ageAverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4071</code></pre>
</div>
</div>
<p>This means we can use this number to index into the data frame and find our answer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.max</span>(df<span class="sc">$</span>ageAverage), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 24
  sampleId        popId site  country region continent groupLabel groupAge flag 
  &lt;chr&gt;           &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 AltaiNeandertal Alta… Deni… Russia  North… Asia      Neanderta… Archaic  0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(df<span class="sc">$</span>ageAverage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 125000</code></pre>
</div>
</div>
<p>Let’s use the similar approach for coverage:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.min</span>(df<span class="sc">$</span>coverage), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 24
  sampleId popId  site        country region continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 NEO496   NEO496 Vasilevka-I Ukraine Centr… Europe    Ukraine_M… Ancient  lowc…
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(df<span class="sc">$</span>coverage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01239792</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.max</span>(df<span class="sc">$</span>coverage), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 24
  sampleId popId site         country region continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 sf12     sf12  Stora F√∂rv… Sweden  North… Europe    Sweden_Me… Ancient  0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(df<span class="sc">$</span>coverage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 58.8661</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-2-selecting-columns" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-selecting-columns">Exercise 2: Selecting columns</h2>
<p>Often times we end up in a situation in which we don’t want to have a large data frame with a huge number of columns. Not as much for the reasons of the data taking up too much memory, but for convenience. You can see that our <code>df</code> metadata table has 24 columns, which don’t fit on the screen if we just print it out (note the “13 more variables” in the output):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 24
   sampleId popId site  country region     continent groupLabel groupAge flag 
   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
 1 NA18486  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 2 NA18488  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 3 NA18489  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 4 NA18498  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 5 NA18499  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 6 NA18501  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 7 NA18502  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 8 NA18504  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
 9 NA18505  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
10 NA18507  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
# ℹ 4,062 more rows
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>We can select which columns to select with the function <code>select()</code>. It has the following general format:</p>
<pre><code>select(&lt;data frame&gt;, &lt;column 1&gt;, &lt;column 2&gt;, ...)</code></pre>
<p>As a reminder, this is how we would select columns using a normal base R subsetting/indexing operation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df[, <span class="fu">c</span>(<span class="st">"sampleId"</span>, <span class="st">"region"</span>, <span class="st">"coverage"</span>, <span class="st">"ageAverage"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 4
   sampleId region     coverage ageAverage
   &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;
 1 NA18486  WestAfrica       NA         NA
 2 NA18488  WestAfrica       NA         NA
 3 NA18489  WestAfrica       NA         NA
 4 NA18498  WestAfrica       NA         NA
 5 NA18499  WestAfrica       NA         NA
 6 NA18501  WestAfrica       NA         NA
 7 NA18502  WestAfrica       NA         NA
 8 NA18504  WestAfrica       NA         NA
 9 NA18505  WestAfrica       NA         NA
10 NA18507  WestAfrica       NA         NA
# ℹ 4,062 more rows</code></pre>
</div>
</div>
<p>This is the <em>tidyverse</em> approach using <code>select()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df, sampleId, region, coverage, ageAverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 4
   sampleId region     coverage ageAverage
   &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;
 1 NA18486  WestAfrica       NA         NA
 2 NA18488  WestAfrica       NA         NA
 3 NA18489  WestAfrica       NA         NA
 4 NA18498  WestAfrica       NA         NA
 5 NA18499  WestAfrica       NA         NA
 6 NA18501  WestAfrica       NA         NA
 7 NA18502  WestAfrica       NA         NA
 8 NA18504  WestAfrica       NA         NA
 9 NA18505  WestAfrica       NA         NA
10 NA18507  WestAfrica       NA         NA
# ℹ 4,062 more rows</code></pre>
</div>
</div>
<p><strong>Note:</strong> The most important thing for you to note now is the absence of “double quotes”. It might not look like much, but saving yourself from having to type double quotes for every data-frame operation (like with base R) is incredibly convenient.</p>
<hr>
<p><strong>Practice <code>select()</code> by creating three new data frame objects (remember that you can assign a value to a variable using the <code>&lt;-</code> operator):</strong></p>
<ol type="1">
<li>Data frame <code>df_ages</code> which contains all variables related to sample ages</li>
<li>Data frame <code>df_geo</code> which contains all variables related to geography</li>
</ol>
<p>Additionally, the first column of these data frames should always be <code>sampleId</code>.</p>
<p><strong>Check visually (or using the <code>ncol()</code> functions) that you indeed have a smaller number of columns in your new data frames.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df_ages <span class="ot">&lt;-</span> <span class="fu">select</span>(df, sampleId, groupAge, age14C, ageHigh, ageLow, ageAverage, ageRaw)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>df_ages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 7
   sampleId groupAge age14C ageHigh ageLow ageAverage ageRaw
   &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; 
 1 NA18486  Modern       NA      NA     NA         NA &lt;NA&gt;  
 2 NA18488  Modern       NA      NA     NA         NA &lt;NA&gt;  
 3 NA18489  Modern       NA      NA     NA         NA &lt;NA&gt;  
 4 NA18498  Modern       NA      NA     NA         NA &lt;NA&gt;  
 5 NA18499  Modern       NA      NA     NA         NA &lt;NA&gt;  
 6 NA18501  Modern       NA      NA     NA         NA &lt;NA&gt;  
 7 NA18502  Modern       NA      NA     NA         NA &lt;NA&gt;  
 8 NA18504  Modern       NA      NA     NA         NA &lt;NA&gt;  
 9 NA18505  Modern       NA      NA     NA         NA &lt;NA&gt;  
10 NA18507  Modern       NA      NA     NA         NA &lt;NA&gt;  
# ℹ 4,062 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df_geo <span class="ot">&lt;-</span> <span class="fu">select</span>(df, site, country, region, latitude, longitude)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>df_geo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 5
   site  country region     latitude longitude
   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;
 1 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 2 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 3 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 4 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 5 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 6 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 7 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 8 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
 9 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
10 &lt;NA&gt;  Nigeria WestAfrica       NA        NA
# ℹ 4,062 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Note:</strong> <code>select()</code> allows us to see the contents of columns of interest much easier. For instance, in a situation in which we want to analyse the geographical location of samples, we don’t want to see columns unrelated to that – <code>select()</code> helps here.</p>
<hr>
<p>If your tables has many columns of interest, typing them all by hand can become tiresome real quick. <strong>Here are a few helper functions which can be very useful in that situation:</strong></p>
<ul>
<li><code>starts_with("age")</code> – matches columns starting with the string “age”</li>
<li><code>ends_with("age")</code> – matches columns ending with the string “age”</li>
<li><code>contains("age")</code> – matches columns containing the string “age”</li>
</ul>
<p><strong>Note:</strong> You can use them in place of normal column names. If we would modify our <code>select()</code> “template” above, we could do this, for instance:</p>
<pre><code>select(&lt;data frame object or tibble&gt;, starts_with("text1"), ends_with("text2"))</code></pre>
<p><strong>Check out the <code>?help</code> belonging to those functions (note that they have <code>ignore.case = TRUE</code> set by default!). Then create the <code>df_ages</code> table again, just like earlier, with the same criteria, but use the three helper functions listed above.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df_ages1 <span class="ot">&lt;-</span> <span class="fu">select</span>(df, sampleId, groupAge, age14C, ageHigh, ageLow, ageAverage, ageRaw)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>df_ages2 <span class="ot">&lt;-</span> <span class="fu">select</span>(df,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                   sampleId,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">starts_with</span>(<span class="st">"age"</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>),</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ends_with</span>(<span class="st">"Age"</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-3-filtering-rows" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-filtering-rows">Exercise 3: Filtering rows</h2>
<p>In the chapter on base R, we learned how to filter rows using the indexing operation along the row-based dimension of (two-dimensional) data frames. For instance, in order to find out which individuals in the metadata are archaics, we first created a <code>TRUE</code> / <code>FALSE</code> vector of the rows corresponding to those individuals like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get a vector of the indices belonging to archaic individuals</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>which_archaic <span class="ot">&lt;-</span> df<span class="sc">$</span>groupAge <span class="sc">==</span> <span class="st">"Archaic"</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># take a peek at the result to make sure we got TRUE / FALSE vector</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(which_archaic, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
</div>
</div>
<p>And then we would use it to index into the data frame (in its first dimension, before the <code>,</code> comma):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>archaic_df <span class="ot">&lt;-</span> df[which_archaic, ]</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>archaic_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 24
  sampleId        popId site  country region continent groupLabel groupAge flag 
  &lt;chr&gt;           &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 Vindija33.19    Vind… Vind… Croatia Centr… Europe    Neanderta… Archaic  0    
2 AltaiNeandertal Alta… Deni… Russia  North… Asia      Neanderta… Archaic  0    
3 Denisova        Deni… Deni… Russia  North… Asia      Denisova_… Archaic  0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>However, what if we need to filter on multiple conditions? For instance, what if we want to find only archaic individuals older than 50000 years?</p>
<p>One option would be to create multiple <code>TRUE</code> / <code>FALSE</code> vectors, each corresponding to one of those conditions, and then join them into a single logical vector by combining <code>&amp;</code> and <code>|</code> logical operators like you did in the previous chapter on logical expressions. For example, we could do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># who is archaic in our data?</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>which_archaic <span class="ot">&lt;-</span> df<span class="sc">$</span>groupAge <span class="sc">==</span> <span class="st">"Archaic"</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># who is older than 50000 years?</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>which_old <span class="ot">&lt;-</span> df<span class="sc">$</span>ageAverage <span class="sc">&gt;</span> <span class="dv">50000</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># who is BOTH? note the AND logical operator!</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>which_combined <span class="ot">&lt;-</span> which_archaic <span class="sc">&amp;</span> which_old</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df[which_combined, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 24
  sampleId        popId site  country region continent groupLabel groupAge flag 
  &lt;chr&gt;           &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 AltaiNeandertal Alta… Deni… Russia  North… Asia      Neanderta… Archaic  0    
2 Denisova        Deni… Deni… Russia  North… Asia      Denisova_… Archaic  0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>But this gets tiring very quickly, requires unnecessary amount of typing, and is very error prone. Imagine having to do this for many more conditions! The <code>filter()</code> function from <em>tidyverse</em> fixes all of these problems.</p>
<p>We can rephrase the example situation with the archaics to use the new function <code>filter()</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, groupAge <span class="sc">==</span> <span class="st">"Archaic"</span> <span class="sc">&amp;</span> ageAverage <span class="sc">&gt;</span> <span class="dv">50000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I hope that, even if you never really programmed much before, you appreciate that this single command involves very little typing and is immediately readable, almost like this English sentence:</p>
<blockquote class="blockquote">
<p><em>“Filter the data frame <code>df</code> for individuals in which column <code>groupAge</code> is”Archaic” and who are older than 50000 years”</em>.</p>
</blockquote>
<p>Over time you will see that all of <em>tidyverse</em> packages follow these ergonomic principles.</p>
<p><strong>Here is the most crucial thing for you to remember! Notice that we refer to columns of our data frame <code>df</code> (like the columns <code>groupAge</code> or <code>ageAverage</code> right above) as if they were normal variables! In any <em>tidyverse</em> function we don’t write <code>"groupAge"</code>, but simply <code>groupAge</code>!</strong> When you start, you’ll probably make this kind of mistake quite often. So this is a reminder to keep an eye for this.</p>
<hr>
<p><strong>Practice filtering with the <code>filter()</code> function by finding out which individual(s) in your <code>df</code> metadata table are from a <code>country</code> with the value <code>"CzechRepublic"</code>.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, country <span class="sc">==</span> <span class="st">"CzechRepublic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 24
  sampleId popId   site       country region continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 NEO128   NEO128  Vedrovice  CzechR… Centr… Europe    Czech_Neo… Ancient  lowc…
2 kol6     kol6    Kol√≠n     CzechR… Centr… Europe    Czech_Neo… Ancient  0    
3 kol2     kol2    Kol√≠n     CzechR… Centr… Europe    Czech_Neo… Ancient  lowG…
4 RISE566  RISE566 Knezeves   CzechR… Centr… Europe    Czech_Bro… Ancient  0    
5 RISE586  RISE586 Moravsk√°… CzechR… Centr… Europe    Czech_Bro… Ancient  0    
6 RISE577  RISE577 Velk√© P≈… CzechR… Centr… Europe    Czech_Bro… Ancient  0    
7 DA111    DA111   Lovosice … CzechR… Centr… Europe    Czech_Iro… Ancient  0    
8 DA112    DA112   Lovosice … CzechR… Centr… Europe    Czech_Iro… Ancient  0    
9 RISE569  RISE569 Brandysek  CzechR… Centr… Europe    Czech_Iro… Ancient  0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Which one of these individuals have <code>coverage</code> higher than 1? Which individuals have <code>coverage</code> higher than 10?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, country <span class="sc">==</span> <span class="st">"CzechRepublic"</span> <span class="sc">&amp;</span> coverage <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 24
  sampleId popId   site       country region continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 kol6     kol6    Kol√≠n     CzechR… Centr… Europe    Czech_Neo… Ancient  0    
2 RISE577  RISE577 Velk√© P≈… CzechR… Centr… Europe    Czech_Bro… Ancient  0    
3 RISE569  RISE569 Brandysek  CzechR… Centr… Europe    Czech_Iro… Ancient  0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, country <span class="sc">==</span> <span class="st">"CzechRepublic"</span> <span class="sc">&amp;</span> coverage <span class="sc">&gt;</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 24
# ℹ 24 variables: sampleId &lt;chr&gt;, popId &lt;chr&gt;, site &lt;chr&gt;, country &lt;chr&gt;,
#   region &lt;chr&gt;, continent &lt;chr&gt;, groupLabel &lt;chr&gt;, groupAge &lt;chr&gt;,
#   flag &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="exercise-4-the-pipe" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4-the-pipe">Exercise 4: The pipe <code>%&gt;%</code></h2>
<p>The pipe operator, <code>%&gt;%</code>, is the rockstar of the <em>tidyverse</em> R ecosystem, and the primary reason what makes <em>tidy</em> data workflow so efficient and easy to read.</p>
<p>First, what is “the pipe”?: whenever you see code like this:</p>
<blockquote class="blockquote">
<p><code>something</code>%&gt;%<code>f()</code></p>
</blockquote>
<p>you can read it as:</p>
<blockquote class="blockquote">
<p><em>“take <strong>something</strong> and put it as the first argument of f()`”</em>.</p>
</blockquote>
<p>Why would you want to do this? Imagine some complex data processing operation like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h</span>(<span class="fu">f</span>(<span class="fu">g</span>(<span class="fu">i</span>(<span class="fu">j</span>(input_data)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This means take <code>input_data</code>, compute <code>j(input_data)</code>, then compute <code>i()</code> on <em>that</em>, so <code>i(j(input_data))</code>, then compute <code>g(i(j(input_data)))</code>, etc. Of course this is an extreme example but is surprisingly not that far off from what we often have to do in data science.</p>
<p>One way to make this easier to read would be perhaps this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>tmp1 <span class="ot">&lt;-</span> <span class="fu">j</span>(input_data)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>tmp2 <span class="ot">&lt;-</span> <span class="fu">i</span>(tmp1)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>tmp3 <span class="ot">&lt;-</span> <span class="fu">g</span>(tmp2)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>tmp4 <span class="ot">&lt;-</span> <span class="fu">f</span>(tmp3)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">f</span>(tmp4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But that’s too much typing when we want to get insights into our data as quickly as possible with as little work as possible.</p>
<p>The pipe approach of <em>tidyverse</em> would make the same thing easier to write and read like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>input_data <span class="sc">%&gt;%</span> j <span class="sc">%&gt;%</span> i <span class="sc">%&gt;%</span> g <span class="sc">%&gt;%</span> f <span class="sc">%&gt;%</span> h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This kind of “data transformation chain” is so frequent that RStudio even provides a built-in shortcut for it:</p>
<ul>
<li>CMD + Shift + M on macOS</li>
<li>CTRL + Shift + M on Windows and Linux</li>
</ul>
<hr>
<p><strong>Use your newly acquired <code>select()</code> and <code>filter()</code> skills, powered by the <code>%&gt;%</code> piping operator, and perform the following transformation on the <code>df</code> metadata table (<code>filter</code>-ing and <code>select</code>-ion operations on the specified columns):</strong></p>
<ol type="1">
<li>First filter individuals for:**</li>
</ol>
<ul>
<li>“Ancient” individuals (<code>groupAge</code>)</li>
<li>older than 10000 years (<code>ageAverage</code>)</li>
<li>from Italy (<code>country</code>)</li>
<li>with <code>coverage</code> higher than 3</li>
</ul>
<ol start="2" type="1">
<li><strong>Then select columns: <code>sampleId</code>, <code>site</code>, <code>sex</code>, and <code>hgMT</code> and <code>hgYMajor</code> (mt and Y haplogoups)</strong>.</li>
</ol>
<p><strong>As a practice, try to be as silly as you can and write the entire command with as many uses of <code>filter()</code> and <code>select()</code> function calls in sequence as you can.</strong></p>
<p><strong>Hint:</strong> Don’t write the entire pipeline at once, start with one condition, evaluate it, then another another one, etc., inspecting the intermediate results as you’re getting them. This is the <em>tidyverse</em> way of doing data science.</p>
<p><strong>Hint:</strong> What I mean by this is that the following two commands produce the exact same result:</p>
<pre><code>new_df1 &lt;- filter(df, col1 == "MatchString", col2 &gt; 10000, col3 == TRUE) %&gt;%
  select(colX, colY, starts_with("ColNamePrefix"))</code></pre>
<p>And doing this instead:</p>
<pre><code>new_df1 &lt;- df %&gt;%
  filter(col1 == "MatchString") %&gt;%
  filter(col2 &gt; 10000) %&gt;%
  filter(col3 == TRUE) %&gt;%
  select(colX, colY, starts_with("ColNamePrefix"))</code></pre>
<p>This works because “the thing on the left” (which is always a data frame) is placed by the <code>%&gt;%</code> pipe operator as “the first argument of a function on the right” (which again expects always a data frame)!</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(groupAge <span class="sc">==</span> <span class="st">"Ancient"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ageAverage <span class="sc">&gt;</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"Italy"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coverage <span class="sc">&gt;</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleId, site, sex, hgMT, hgYMajor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  sampleId site              sex   hgMT              hgYMajor
  &lt;chr&gt;    &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;             &lt;chr&gt;   
1 R7       Grotta Continenza XY    U5b1+16189+@16192 I2a     </code></pre>
</div>
</div>
<p>We could also write the same thing more concisely (not the single <code>filter()</code> call):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(groupAge <span class="sc">==</span> <span class="st">"Ancient"</span>, ageAverage <span class="sc">&gt;</span> <span class="dv">10000</span>, country <span class="sc">==</span> <span class="st">"Italy"</span>, coverage <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleId, site, sex, hgMT, hgYMajor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  sampleId site              sex   hgMT              hgYMajor
  &lt;chr&gt;    &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;             &lt;chr&gt;   
1 R7       Grotta Continenza XY    U5b1+16189+@16192 I2a     </code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Note:</strong> It is always a good practice to split long chains of <code>%&gt;%</code> piping commands into multiple lines, and indenting them neatly one after the other. Readability matters to avoid bugs in your code!</p>
<hr>
</section>
<section id="exercise-5-more-complex-conditions" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5-more-complex-conditions">Exercise 5: More complex conditions</h2>
<p>Recall our exercises about logical conditional expression (<code>&amp;</code>, <code>|</code>, <code>!</code>, etc.). You can interpret <code>,</code> in a <code>filter()</code> command as a logical <code>&amp;</code>. In fact, you could also write the solution to the previous exercise:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(groupAge <span class="sc">==</span> <span class="st">"Ancient"</span>, ageAverage <span class="sc">&gt;</span> <span class="dv">10000</span>, country <span class="sc">==</span> <span class="st">"Italy"</span>, coverage <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleId, site, sex, hgMT, hgYMajor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>as this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(groupAge <span class="sc">==</span> <span class="st">"Ancient"</span> <span class="sc">&amp;</span> ageAverage <span class="sc">&gt;</span> <span class="dv">10000</span> <span class="sc">&amp;</span> country <span class="sc">==</span> <span class="st">"Italy"</span> <span class="sc">&amp;</span> coverage <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleId, site, sex, hgMT, hgYMajor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Whenever you need to do a more complex operation, such as saying that a variable <code>columnX</code> should have a value <code>"ABC"</code> or <code>"ZXC"</code>, you can write <code>filter(df, columnX == "ABC" | column == "ZXC")</code>.</p>
<p>Similarly, you can condition on numerical variables, just as we did in the exercises on <code>TRUE</code> / <code>FALSE</code> expressions. For instance, if you want to condition on a column <code>varX</code> being <code>varX &lt; 1</code> <em>or</em> <code>varX &gt; 10</code>, you could write <code>filter(df, varX &lt; 1 | var X &gt; 10)</code>.</p>
<hr>
<p><strong>Practice combining multiple filtering conditions into a <em>tidyverse</em> piping chain by filtering our metadata table to find individuals for which the following conditions hold:</strong></p>
<ul>
<li>They are “Ancient” (<code>groupAge</code>).</li>
<li>The <code>country</code> is “France” <em>or</em> “Canary Islands”.</li>
<li>Their <code>coverage</code> less than 0.1 or more than 3.</li>
</ul>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(groupAge <span class="sc">==</span> <span class="st">"Ancient"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"France"</span> <span class="sc">|</span> country <span class="sc">==</span> <span class="st">"Canary Islands"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coverage <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">|</span> coverage <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 24
  sampleId popId  site        country region continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 gun011   gun011 Tenerife    Canary… North… Africa    CanaryIsl… Ancient  0    
2 NEO812   NEO812 Grotte du … France  Weste… Europe    France_Ne… Ancient  0    
3 NEO813   NEO813 Grotte du … France  Weste… Europe    France_Ne… Ancient  1d_r…
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>Whenever you want to test whether a variable is of a set of multiple possible values, you can use the <code>%in%</code> operator:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(groupAge <span class="sc">==</span> <span class="st">"Ancient"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"Canary Islands"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coverage <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">|</span> coverage <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 24
  sampleId popId  site        country region continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 gun011   gun011 Tenerife    Canary… North… Africa    CanaryIsl… Ancient  0    
2 NEO812   NEO812 Grotte du … France  Weste… Europe    France_Ne… Ancient  0    
3 NEO813   NEO813 Grotte du … France  Weste… Europe    France_Ne… Ancient  1d_r…
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="exercise-6-dropping-columns" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6-dropping-columns">Exercise 6: Dropping columns</h2>
<p>This one will be easy. If you want to drop a column from a table, just prefix its name with a minus sign (<code>-</code>).</p>
<p><strong>Note:</strong> Yes, this also works with <code>starts_with()</code> and its friends above, just put <code>-</code> in front of them!</p>
<p>Here’s our <code>df</code> table again (just one row for brevity):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 24
  sampleId popId site  country region     continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 NA18486  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>Observe what happens when we do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>sampleId) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 23
  popId site  country region     continent groupLabel groupAge flag  latitude
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;
1 YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0           NA
# ℹ 14 more variables: longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;,
#   ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;, datingSource &lt;chr&gt;,
#   coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;, ageRaw &lt;chr&gt;,
#   hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>And this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>sampleId, <span class="sc">-</span>site) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 22
  popId country region    continent groupLabel groupAge flag  latitude longitude
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 YRI   Nigeria WestAfri… Africa    YRI        Modern   0           NA        NA
# ℹ 13 more variables: dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;, datingSource &lt;chr&gt;, coverage &lt;dbl&gt;,
#   sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;, ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;,
#   hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>And this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>sampleId, <span class="sc">-</span>site, <span class="sc">-</span>popId) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 21
  country region     continent groupLabel groupAge flag  latitude longitude
  &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Nigeria WestAfrica Africa    YRI        Modern   0           NA        NA
# ℹ 13 more variables: dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;, datingSource &lt;chr&gt;, coverage &lt;dbl&gt;,
#   sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;, ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;,
#   hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>The columns prefixed with <code>-</code> are dropped from the resulting table!</p>
<p>Rather than typing out a long list of columns to drop, we can also do this to specify the range of consecutive columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>(sampleId<span class="sc">:</span>popId)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 22
  site  country region    continent groupLabel groupAge flag  latitude longitude
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 &lt;NA&gt;  Nigeria WestAfri… Africa    YRI        Modern   0           NA        NA
# ℹ 13 more variables: dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;, datingSource &lt;chr&gt;, coverage &lt;dbl&gt;,
#   sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;, ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;,
#   hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>Alternatively, we can also use our well-known <code>c()</code> function, which is very useful whenever we want to drop a non-consecutive set of columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(sampleId, site, popId)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 21
  country region     continent groupLabel groupAge flag  latitude longitude
  &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Nigeria WestAfrica Africa    YRI        Modern   0           NA        NA
# ℹ 13 more variables: dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;, datingSource &lt;chr&gt;, coverage &lt;dbl&gt;,
#   sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;, ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;,
#   hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p><strong>Note:</strong> The same “range syntax” of using <code>:</code> and and listing columns with <code>c()</code> applies also to selecting which columns to choose, not just for dropping them.</p>
<hr>
<p><strong>Use the <code>:</code> range in <code>select()</code> to drop every column after <code>country</code> (i.e., all the way to the last column in your table).</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>(region<span class="sc">:</span>hgYMinor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 4
   sampleId popId site  country
   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
 1 NA18486  YRI   &lt;NA&gt;  Nigeria
 2 NA18488  YRI   &lt;NA&gt;  Nigeria
 3 NA18489  YRI   &lt;NA&gt;  Nigeria
 4 NA18498  YRI   &lt;NA&gt;  Nigeria
 5 NA18499  YRI   &lt;NA&gt;  Nigeria
 6 NA18501  YRI   &lt;NA&gt;  Nigeria
 7 NA18502  YRI   &lt;NA&gt;  Nigeria
 8 NA18504  YRI   &lt;NA&gt;  Nigeria
 9 NA18505  YRI   &lt;NA&gt;  Nigeria
10 NA18507  YRI   &lt;NA&gt;  Nigeria
# ℹ 4,062 more rows</code></pre>
</div>
</div>
<p>I was personally a bit surprised that this also works without the parentheses. R is smart!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>region<span class="sc">:-</span>hgYMinor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 4
   sampleId popId site  country
   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
 1 NA18486  YRI   &lt;NA&gt;  Nigeria
 2 NA18488  YRI   &lt;NA&gt;  Nigeria
 3 NA18489  YRI   &lt;NA&gt;  Nigeria
 4 NA18498  YRI   &lt;NA&gt;  Nigeria
 5 NA18499  YRI   &lt;NA&gt;  Nigeria
 6 NA18501  YRI   &lt;NA&gt;  Nigeria
 7 NA18502  YRI   &lt;NA&gt;  Nigeria
 8 NA18504  YRI   &lt;NA&gt;  Nigeria
 9 NA18505  YRI   &lt;NA&gt;  Nigeria
10 NA18507  YRI   &lt;NA&gt;  Nigeria
# ℹ 4,062 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-7-renaming-columns" class="level2">
<h2 class="anchored" data-anchor-id="exercise-7-renaming-columns">Exercise 7: Renaming columns</h2>
<p>Very often you read data frames in which columns have names which are either very long, containing characters which are not allowed, or generally inconvenient. Imagine a situation, in which you refer to a particular column very often in your workflow, but it takes too much time to type it out.</p>
<p>After discussing <code>select()</code> and <code>filter()</code>, let’s introduce another member of the <em>tidyverse</em> – the function <code>rename()</code>.</p>
<p>The template for using it is again very easy (again, you would replace the text in <code>&lt;here&gt;</code> with appropriate symbols):</p>
<pre><code>rename(&lt;data frame&gt;, &lt;new name&gt; = &lt;old name&gt;)</code></pre>
<hr>
<p><strong>Create a new data frame <code>df_subset</code> by doing the following:</strong></p>
<ol type="1">
<li><p>First <code>select()</code> the columns <code>sampleId</code>, <code>popId</code>, <code>country</code>, <code>continent</code>, <code>groupAge</code>, <code>ageAverage</code>, and <code>coverage</code>.</p></li>
<li><p>Then use the <code>rename()</code> function to give them a shorter name: <code>sampleId</code> -&gt; <code>sample</code>, <code>popId</code> -&gt; <code>population</code>, <code>groupAge</code> -&gt; <code>set</code>, <code>ageAverage</code> -&gt; <code>age</code>. Leave the <code>country</code> and <code>coverage</code> columns as they are.**</p></li>
</ol>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>df_subset <span class="ot">&lt;-</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampleId, popId, country, continent, groupAge, ageAverage, coverage) <span class="sc">%&gt;%</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sample =</span> sampleId, <span class="at">population =</span> popId, <span class="at">set =</span> groupAge, <span class="at">age =</span> ageAverage)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>df_subset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 7
   sample  population country continent set      age coverage
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1 NA18486 YRI        Nigeria Africa    Modern    NA       NA
 2 NA18488 YRI        Nigeria Africa    Modern    NA       NA
 3 NA18489 YRI        Nigeria Africa    Modern    NA       NA
 4 NA18498 YRI        Nigeria Africa    Modern    NA       NA
 5 NA18499 YRI        Nigeria Africa    Modern    NA       NA
 6 NA18501 YRI        Nigeria Africa    Modern    NA       NA
 7 NA18502 YRI        Nigeria Africa    Modern    NA       NA
 8 NA18504 YRI        Nigeria Africa    Modern    NA       NA
 9 NA18505 YRI        Nigeria Africa    Modern    NA       NA
10 NA18507 YRI        Nigeria Africa    Modern    NA       NA
# ℹ 4,062 more rows</code></pre>
</div>
</div>
<p>We now have a much cleaner table which is much easier to work with!</p>
</div>
</div>
</div>
<hr>
<p><strong>A shortcut which can be quite useful sometimes is that <code>select()</code> also accepts the <code>new_name = old_name</code> syntax of the <code>rename()</code> function, which allows you to both select columns (and rename some of them) all at once. Create the <code>df_subset</code> data frame again, but this time using just <code>select()</code>.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>df_subset <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">sample =</span> sampleId, <span class="at">population =</span> popId,</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>         country,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>         continent,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">set =</span> groupAge, <span class="at">age =</span> ageAverage,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>         coverage)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>df_subset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 7
   sample  population country continent set      age coverage
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1 NA18486 YRI        Nigeria Africa    Modern    NA       NA
 2 NA18488 YRI        Nigeria Africa    Modern    NA       NA
 3 NA18489 YRI        Nigeria Africa    Modern    NA       NA
 4 NA18498 YRI        Nigeria Africa    Modern    NA       NA
 5 NA18499 YRI        Nigeria Africa    Modern    NA       NA
 6 NA18501 YRI        Nigeria Africa    Modern    NA       NA
 7 NA18502 YRI        Nigeria Africa    Modern    NA       NA
 8 NA18504 YRI        Nigeria Africa    Modern    NA       NA
 9 NA18505 YRI        Nigeria Africa    Modern    NA       NA
10 NA18507 YRI        Nigeria Africa    Modern    NA       NA
# ℹ 4,062 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>When would you use one or the other?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Answer: <code>select()</code> always drops the columns which are not explicitly listed. <code>rename()</code> only renames the columns which are listed, but retains everything().</p>
</div>
</div>
</div>
<hr>
</section>
<section id="exercise-8-reorganizing-columns" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8-reorganizing-columns">Exercise 8: Reorganizing columns</h2>
<p>Let’s look at another useful application of the <code>select()</code> function and that is reordering columns. Our <code>df</code> metadata table has 24 columns. When we print it out, we only see a couple of them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 24
  sampleId popId site  country region     continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 NA18486  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
2 NA18488  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
3 NA18489  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>Oftentimes when doing data analysis, we often work interactively in the console, focusing on a specific subset of columns, and need to immediately see the values of our columns of interest – how can we do this?</p>
<p>We already know that we can use <code>select()</code> to pick those columns of interest, but this removes the non-selected columns from the data frame we get. Whenever we want to retain them, we can add the call to <code>everything()</code>, like this:</p>
<pre><code>select(&lt;data frame&gt;, &lt;column 1&gt;, &lt;column 2&gt;, ..., everything())</code></pre>
<p>Which effectively moves <code>&lt;column 1&gt;</code>, <code>&lt;column 2&gt;</code>, … to the “front” of our table, and adds everything else at the end.</p>
<p><strong>Select the subset of columns you selected in the previous exercise on renaming in exactly the same way, but this time add a call to <code>everything()</code> at the end to keep the entire data set intact (with just columns rearranged). Save the result to <code>df</code> again.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Our data frame before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 24
  sampleId popId site  country region     continent groupLabel groupAge flag 
  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
1 NA18486  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
2 NA18488  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
3 NA18489  YRI   &lt;NA&gt;  Nigeria WestAfrica Africa    YRI        Modern   0    
# ℹ 15 more variables: latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, dataSource &lt;chr&gt;,
#   age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;, ageAverage &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, coverage &lt;dbl&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">select</span>(df, <span class="at">sample =</span> sampleId, <span class="at">population =</span> popId, country, continent,</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">set =</span> groupAge, <span class="at">age =</span> ageAverage, coverage,</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our data frame after:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 24
  sample  population country continent set      age coverage site  region    
  &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     
1 NA18486 YRI        Nigeria Africa    Modern    NA       NA &lt;NA&gt;  WestAfrica
2 NA18488 YRI        Nigeria Africa    Modern    NA       NA &lt;NA&gt;  WestAfrica
3 NA18489 YRI        Nigeria Africa    Modern    NA       NA &lt;NA&gt;  WestAfrica
# ℹ 15 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
<p>Notice that we prioritized the selected columns of interest (and also renamed some for more readability), but we still have all the other columns available!</p>
</div>
</div>
</div>
</section>
<section id="exercise-9-sorting-rows-based-on-columns" class="level2">
<h2 class="anchored" data-anchor-id="exercise-9-sorting-rows-based-on-columns">Exercise 9: Sorting rows based on columns</h2>
<p>When you need to sort the rows of a data frame based on a value of one or multiple columns, you can use the function <code>arrange()</code>. Again, in the spirit of the consistency across the <em>tidyverse</em> ecosystem, it follows exactly the same format of first giving the function a data frame to operate on, followed by a list of columns to sort by.</p>
<pre><code>arrange(&lt;data frame&gt;, &lt;column 1&gt;, &lt;column 2&gt;, ...)</code></pre>
<p><strong>Note:</strong> When you want to reverse the order of the sort, you can surround the column name in a helper function <code>desc()</code> (standing for “descending”).</p>
<pre><code>arrange(&lt;data frame&gt;, desc(&lt;column 1&gt;), desc(&lt;column 2&gt;), ...)</code></pre>
<hr>
<p><strong>Who is the oldest individual in your data who is not an archaic individual? (Remember that you can <code>filter()</code> out rows corresponding to archaic individuals with the condition <code>set != "Ancient"</code> and then pipe the result into <code>arrange()</code> for sorting based on the renamed column <code>age</code>).</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(set <span class="sc">!=</span> <span class="st">"Archaic"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,069 × 24
   sample   population country continent set        age coverage site     region
   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; 
 1 UstIshim UstIshim   Russia  Asia      Ancient 45020    35.2   Ust'-Is… North…
 2 Kostenki Kostenki   Russia  Europe    Ancient 37470     2.53  Kostenki Centr…
 3 SII      SII        Russia  Europe    Ancient 34234     4.25  Sunghir  Centr…
 4 SIII     SIII       Russia  Europe    Ancient 34092.   11.2   Sunghir  Centr…
 5 SIV      SIV        Russia  Europe    Ancient 33992     4.04  Sunghir  Centr…
 6 SI       SI         Russia  Europe    Ancient 32822.    1.16  Sunghir  Centr…
 7 Yana     Yana       Russia  Asia      Ancient 31950    26.5   Yana RHS North…
 8 Yana2    Yana2      Russia  Asia      Ancient 31950     6.81  Yana RHS North…
 9 NEO283   NEO283     Georgia Asia      Ancient 25635     0.786 Kotias … Weste…
10 MA1      MA1        Russia  Asia      Ancient 24305     1.09  Mal'ta   North…
# ℹ 4,059 more rows
# ℹ 15 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Similarly, who is the youngest ancient individual in your data in terms of its dating?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(set <span class="sc">==</span> <span class="st">"Ancient"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,664 × 24
   sample  population country   continent set       age coverage site     region
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; 
 1 Andaman Andaman    India     Asia      Ancient   90    16.6   Great A… South…
 2 890     890        Argentina America   Ancient  100     0.508 Beagle … South…
 3 894     894        Argentina America   Ancient  100     0.983 Beagle … South…
 4 895     895        Argentina America   Ancient  100     1.32  Beagle … South…
 5 MA577   MA577      Argentina America   Ancient  100     1.82  Tierra … South…
 6 Nr74    Nr74       Chile     America   Ancient  100     0.438 Strait … South…
 7 AM71    AM71       Chile     America   Ancient  100     0.103 Strait … South…
 8 523a_C  523a_C     USA       America   Ancient  125     0.956 Palm Si… North…
 9 Vt719   Vt719      Vietnam   Asia      Ancient  154.    0.257 Northea… South…
10 KOV-A-2 KOV-A-2    Iceland   Europe    Ancient  236     0.685 Kopavog… North…
# ℹ 1,654 more rows
# ℹ 15 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Does the same approach work for sorting text? What do you get when you try sorting based on the <code>country</code> column?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Yes, this gives us standard alphabetical sort!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 24
   sample    population country   continent set       age coverage site   region
   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
 1 Aconcagua Aconcagua  Argentina America   Ancient  500    2.67   Cerro… South…
 2 890       890        Argentina America   Ancient  100    0.508  Beagl… South…
 3 894       894        Argentina America   Ancient  100    0.983  Beagl… South…
 4 895       895        Argentina America   Ancient  100    1.32   Beagl… South…
 5 MA577     MA577      Argentina America   Ancient  100    1.82   Tierr… South…
 6 NEO110    NEO110     Armenia   Asia      Ancient 7594    0.0605 Aknas… Weste…
 7 RISE423   RISE423    Armenia   Asia      Ancient 3256.   0.366  Nerqu… Weste…
 8 DA31      DA31       Armenia   Asia      Ancient 3314.   0.345  Lchas… Weste…
 9 DA35      DA35       Armenia   Asia      Ancient 3314.   1.62   Lchas… Weste…
10 RISE407   RISE407    Armenia   Asia      Ancient 2955    0.187  Norab… Weste…
# ℹ 4,062 more rows
# ℹ 15 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>What do you get when you try sorting based on <code>country</code> and then <code>coverage</code>? What happens when you sort based on <code>coverage</code> and then <code>country</code>? Why is there a difference?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(country, coverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 24
   sample    population country   continent set       age coverage site   region
   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
 1 890       890        Argentina America   Ancient  100    0.508  Beagl… South…
 2 894       894        Argentina America   Ancient  100    0.983  Beagl… South…
 3 895       895        Argentina America   Ancient  100    1.32   Beagl… South…
 4 MA577     MA577      Argentina America   Ancient  100    1.82   Tierr… South…
 5 Aconcagua Aconcagua  Argentina America   Ancient  500    2.67   Cerro… South…
 6 NEO110    NEO110     Armenia   Asia      Ancient 7594    0.0605 Aknas… Weste…
 7 RISE407   RISE407    Armenia   Asia      Ancient 2955    0.187  Norab… Weste…
 8 DA31      DA31       Armenia   Asia      Ancient 3314.   0.345  Lchas… Weste…
 9 RISE423   RISE423    Armenia   Asia      Ancient 3256.   0.366  Nerqu… Weste…
10 RISE397   RISE397    Armenia   Asia      Ancient 2902.   0.392  Kapan  Weste…
# ℹ 4,062 more rows
# ℹ 15 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(coverage, country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 24
   sample population country continent set       age coverage site        region
   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt; 
 1 NEO496 NEO496     Ukraine Europe    Ancient 10655   0.0124 Vasilevka-I Centr…
 2 NEO7   NEO7       Denmark Europe    Ancient  5240   0.0127 Sigersdal … North…
 3 NEO13  NEO13      Denmark Europe    Ancient  9511   0.0134 Hedegaard … North…
 4 NEO580 NEO580     Denmark Europe    Ancient  4612   0.0134 Klokkehøj   North…
 5 NEO1   NEO1       Denmark Europe    Ancient  6594   0.0150 Holmegård-… North…
 6 NEO916 NEO916     Russia  Asia      Ancient  5727   0.0175 Vengerovo-2 North…
 7 NEO41  NEO41      Denmark Europe    Ancient  5531   0.0195 Rude        North…
 8 NEO915 NEO915     Russia  Asia      Ancient  5727   0.0202 Vengerovo-2 North…
 9 NEO566 NEO566     Denmark Europe    Ancient  5135   0.0206 Døjringe    North…
10 NEO961 NEO961     Denmark Europe    Ancient  5149   0.0229 Avlebjerg … North…
# ℹ 4,062 more rows
# ℹ 15 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Does it matter what order you use <code>filter()</code> (on some column) and <code>arrange()</code> (on another column) if you’re using both functions? If yes, why? If not, why not? Think about the amount of work these functions have to do.</strong></p>
</section>
<section id="exercise-10-mutating-tables" class="level2">
<h2 class="anchored" data-anchor-id="exercise-10-mutating-tables">Exercise 10: Mutating tables</h2>
<p>Mutating a table means adding a column for a new variable. Again, as with the previously introduced functions <code>select()</code>, <code>filter()</code>, and <code>rename()</code> and <code>arrange()</code>, it follows a consistent _tidyverse_pattern:</p>
<pre><code>df %&gt;% mutate(&lt;new column name&gt; = &lt;vector of the required length&gt;)</code></pre>
<p>Not surprisingly, the new column is assigned a vector of the same length as the number of rows in a data frame. What we often do is this:</p>
<pre><code>df %&gt;% mutate(&lt;new column name&gt; = &lt;expression involving other columns&gt;)</code></pre>
<p>because <code>mutate()</code> allows us to refer to other columns in the data frame already present.</p>
<p><strong>To demonstrate this on a couple of exercises, let’s actually <em>remove</em> some columns from our data frame first. They were originally created by <code>mutate()</code> in the first place and this gives as a useful opportunity for practice:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">select</span>(df, <span class="sc">-</span>set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Don’t worry, we’ll be adding them back soon using our custom code.</p>
<p>The important aspect of mutate is that it is a <em>vectorized</em> operation. We can’t create a column and give values to only some rows. Here are several ways how we could do this:</p>
<section id="if_else" class="level3">
<h3 class="anchored" data-anchor-id="if_else">1. <code>if_else()</code></h3>
<p><code>if_else()</code> accepts a logical vector (i.e., a vector of <code>TRUE</code> / <code>FALSE</code> values), and produces another vector which contains one value for each <code>TRUE</code>, and another value for each <code>FALSE</code>. Here is an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(v, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  1 -1  1 -1</code></pre>
</div>
</div>
<p>Notice that we get 1 for each <code>TRUE</code> and -1 for each <code>FALSE</code>.</p>
<hr>
<p><strong>This can be a bit confusing, so spend a bit of time playing around with <code>if_else()</code>. For instance, create a different logical vector, and have the function produce values “hello” and “bye” depending on <code>TRUE</code> / <code>FALSE</code> state of each element. Just get familiar with this vectorized thinking because whenever we do data science, it almost always happens in this vectorized fashion (such as operating on every single value in a column of a table at once).</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(v, <span class="st">"hello"</span>, <span class="st">"bye"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bye"   "bye"   "bye"   "hello" "hello" "bye"   "hello" "bye"  </code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p>This function is extremely useful whenever we need to generate values of a new column based on values of another column(s). The general pattern for using it inside a <code>mutate()</code> call is this:</p>
<pre><code>df %&gt;%
  mutate(&lt;new_column&gt; = if_else(&lt;logical vector&gt;, true_value, false_value))</code></pre>
<hr>
<p><strong>You can see that the column <code>df$sex</code> contains chromosome sex determination of each individual as either <code>XY</code> or <code>XX</code>. Use the <code>if_else()</code> function in a <code>mutate()</code> call to create a new column <code>sex_desc</code> which will contain a character vector of either “male” or “female” depending on the sex chromosome determination.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df, <span class="at">sex_desc =</span> <span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="st">"XY"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Run <code>table(df$sex, df$sex_value)</code> to make sure the assignment of sex description worked as expected. How do you interpret the results? Did we miss something? If we did, what is wrong?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Oh, we can see that there’s an “XXY” individual who – because of our improperly specified <code>if_else()</code> condition (which assigns individuals as male only when they are “XY”) – got assigned in to the “female” category.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>sex, df<span class="sc">$</span>sex_desc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     
      female male
  XX    1862    0
  XXY      1    0
  XY       0 2209</code></pre>
</div>
</div>
<p>We would’ve noticed this in our exploratory phased, had we checked the range of possible values of the <code>sex</code> column like this. This is why getting familiar with all data is so crucial the first time we look at it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  XX  XXY   XY 
1862    1 2209 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "XY"  "XX"  "XXY"</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p>It turns out there is an individual with a <a href="https://en.wikipedia.org/wiki/Klinefelter_syndrome">Klinefelter syndrome</a>. A male carrying an extra X chromosome. <strong>Clearly the logic of our <code>if_else()</code> is incorrect because this individual was incorrectly assigned as “female”. How would you fix the <code>mutate()</code> command to work correctly?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There are a number of options. This is simplest, we can just flip the condition:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df, <span class="at">sex_desc =</span> <span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="st">"XX"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But it may be better to be more explicit?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df, <span class="at">sex_desc =</span> <span class="fu">if_else</span>(sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"XY"</span>, <span class="st">"XXY"</span>), <span class="st">"male"</span>, <span class="st">"female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can verify that the assignment of sex description worked correctly now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>sex, df<span class="sc">$</span>sex_desc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     
      female male
  XX    1862    0
  XXY      0    1
  XY       0 2209</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Always remember to check assumptions in your data, even the ones you consider trivial. Functions such as <code>table()</code> and <code>unique()</code> are extremely useful for this.</p>
<hr>
<p><strong>Let’s practice <code>if_else()</code> a bit more. First, use <code>filter()</code> to look at the values of the <code>age</code> column for present-day individuals in the 1000 Genomes Project data (<code>dataSource == "1000g"</code>). What ages do you see?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The individuals have <code>NA</code> age. This could be annoying if we ever want to plot some population genetic statistics as functions of age:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dataSource <span class="sc">==</span> <span class="st">"1000g"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,405 × 24
   sample  population country continent   age coverage site  region   groupLabel
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;     
 1 NA18486 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 2 NA18488 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 3 NA18489 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 4 NA18498 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 5 NA18499 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 6 NA18501 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 7 NA18502 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 8 NA18504 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
 9 NA18505 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
10 NA18507 YRI        Nigeria Africa       NA       NA &lt;NA&gt;  WestAfr… YRI       
# ℹ 2,395 more rows
# ℹ 15 more variables: flag &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;,
#   dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;, ageRaw &lt;chr&gt;,
#   hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;, sex_desc &lt;chr&gt;</code></pre>
</div>
</div>
<p>Is there anyone in the 1000 GP data who has an age specified?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dataSource <span class="sc">==</span> <span class="st">"1000g"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 24
# ℹ 24 variables: sample &lt;chr&gt;, population &lt;chr&gt;, country &lt;chr&gt;,
#   continent &lt;chr&gt;, age &lt;dbl&gt;, coverage &lt;dbl&gt;, site &lt;chr&gt;, region &lt;chr&gt;,
#   groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;,
#   dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;, ageLow &lt;dbl&gt;,
#   datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;, ageRaw &lt;chr&gt;,
#   hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;, sex_desc &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>You already know that you can get a logical vector indicating whether a certain element of another vector (here, the column <code>age</code>) is <code>NA</code> or not via the function <code>is.na()</code>. Use <code>is.na(age)</code> in the <code>if_else()</code> to set the <code>age</code> column with the <code>mutate()</code> function so that:</strong></p>
<ol type="1">
<li>Rows where <code>is.na(age)</code> is <code>TRUE</code> are set to 0, and</li>
<li>Rows where <code>is.na(age)</code> is <code>FALSE</code> are set to <code>age</code> (because those values don’t need to be replaced).</li>
</ol>
<p><strong>Note:</strong> Using <code>mutate()</code> to replace values of an existing column (rather than creating a new column) is done very often in data science, particularly in “clean up” operations like this one.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The individuals have <code>NA</code> age. This could be annoying if we ever want to plot some population genetic statistics as functions of age:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(age), <span class="dv">0</span>, age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="case_when" class="level3">
<h3 class="anchored" data-anchor-id="case_when">2. <code>case_when()</code></h3>
<p><code>if_else()</code> does only work on binary <code>TRUE</code> or <code>FALSE</code> conditions. But what if we want to create a new column with values of multiple categories, not just two. Recall our original column <code>set</code>, which had values either “Archaic”, “Ancient”, or “Modern”.</p>
<p>For this purpose, <code>case_when()</code> is perfect. It works in a very similar manner to <code>if_else()</code>. Consider this vector of numbers between 1 and 30:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we wanted to assign a value “less_than_10” or “10_or_more” to each element, we could use the function <code>if_else()</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(v <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">"less than 10"</span>, <span class="st">"10 or more"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "less than 10" "less than 10" "less than 10" "less than 10" "less than 10"
 [6] "less than 10" "less than 10" "less than 10" "less than 10" "10 or more"  
[11] "10 or more"   "10 or more"   "10 or more"   "10 or more"   "10 or more"  
[16] "10 or more"   "10 or more"   "10 or more"   "10 or more"   "10 or more"  </code></pre>
</div>
</div>
<p>What if we want to introduce three or more categories? <code>case_when()</code> to the rescue!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">case_when</span>(</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  v <span class="sc">&lt;</span> <span class="dv">10</span>  <span class="sc">~</span> <span class="st">"less than 5"</span>,</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  v <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"exactly 10"</span>,</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  v <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"more than 10"</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "less than 5"  "less than 5"  "less than 5"  "less than 5"  "less than 5" 
 [6] "less than 5"  "less than 5"  "less than 5"  "less than 5"  "exactly 10"  
[11] "more than 10" "more than 10" "more than 10" "more than 10" "more than 10"
[16] "more than 10" "more than 10" "more than 10" "more than 10" "more than 10"</code></pre>
</div>
</div>
<p>Remember how we had a slightly annoying time with doing vectorized conditional logical expressions on <code>TRUE</code> / <code>FALSE</code> vectors? Now it’s all paying off! Every one of the three conditions actually result in a logical vector, and <code>case_when()</code> decides which value to produced for each element of that vector based on whichever results in <code>TRUE</code></p>
<p>The <code>case_when()</code> function has a very useful optional argument called <code>.default =</code>, which determines the value it should return whenever a particular location in the logical vector either results in all <code>FALSE</code> (so none of the conditions would apply), or whenever it produces a <code>NA</code> value (so none of the conditions can apply even in principle).</p>
<hr>
<p><strong>First, let’s start simple and reimplement the <code>mutate()</code> operation to add the <code>sex_desc</code> column again, this time using <code>case_when()</code> and implementing the three conditions (“XX”, “XY”, “XXY”) individually. Additionally, use the <code>.default =</code> argument of <code>case_when()</code> to assign “unknown” as a value of the <code>sex_desc</code> column.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_desc =</span> <span class="fu">case_when</span>(</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"XX"</span> <span class="sc">~</span> <span class="st">"female"</span>,</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"XY"</span> <span class="sc">~</span> <span class="st">"male"</span>,</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"XXY"</span> <span class="sc">~</span> <span class="st">"male"</span>,</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"unknown"</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check that this worked correctly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>sex, df<span class="sc">$</span>sex_desc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     
      female male
  XX    1862    0
  XXY      0    1
  XY       0 2209</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>In the exercise on conditional expressions, you learned about <code>&amp;</code> and <code>|</code> operators which make it possible to combine multiple conditions into a single <code>TRUE</code> / <code>FALSE</code> vector. Of course, this means that the conditions inside the <code>case_when()</code> function can also utilize those operators.</strong></p>
<p><strong>Create a new column <code>sex_set</code> which will contain the following values:</strong></p>
<ol type="1">
<li><code>sex == "XX" &amp; age == 0" should produce</code>“female (present-day)”`,</li>
<li><code>(sex == "XY" | sex == "XXY") &amp; age == 0" should produce</code>“male (present-day)”`,</li>
<li><code>sex == "XX" &amp; age &gt; 0" should produce</code>“female (ancient)”`,</li>
<li><code>(sex == "XY" | sex == "XXY") &amp; age &gt; 0" should produce</code>“male (ancient)”`,</li>
<li>any other combination should default to “other”</li>
</ol>
<p><strong>I provided the logical conditions for you, you just have to put them in a <code>case_when()</code> call appropriately, modifying the solution to the previous exercise. Verify the outcome by doing <code>table(df$sex_set)</code> again.</strong></p>
<p><strong>Why did I put parenthesis around the sub-clause involving the <code>|</code> OR operator? What happens if we don’t do this?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_set =</span> <span class="fu">case_when</span>(</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"XX"</span> <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="dv">0</span>                   <span class="sc">~</span> <span class="st">"female (present-day)"</span>,</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"XX"</span> <span class="sc">&amp;</span> age <span class="sc">&gt;</span> <span class="dv">0</span>                    <span class="sc">~</span> <span class="st">"female (ancient)"</span>,</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>    (sex <span class="sc">==</span> <span class="st">"XY"</span> <span class="sc">|</span> sex <span class="sc">==</span> <span class="st">"XXY"</span>) <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="dv">0</span>  <span class="sc">~</span> <span class="st">"male (present-day)"</span>,</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>    (sex <span class="sc">==</span> <span class="st">"XY"</span> <span class="sc">|</span> sex <span class="sc">==</span> <span class="st">"XXY"</span>) <span class="sc">&amp;</span> age <span class="sc">&gt;</span> <span class="dv">0</span>   <span class="sc">~</span> <span class="st">"male (ancient)"</span>,</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check that this worked correctly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>sex_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    female (ancient) female (present-day)       male (ancient) 
                 641                 1221                 1026 
  male (present-day) 
                1184 </code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Remember how we removed the <code>set</code> column, which originally contained values “Modern”, “Ancient”, or “Archaic”, depending on whether the individual was a present-day modern human, ancient modern human, or an archaic individual, respectively? Use what you learned in this exercise on <code>if_else()</code> or <code>case_when()</code> to reconstruct this column again based on information in the remaining columns.</strong> (There is many possible solutions, so don’t be afraid to think creatively!)</p>
<p><strong>Hint:</strong> Using information in <code>age</code> and the names of the three archaic individuals (combined with the <code>.default</code> argument of <code>case_when()</code> is probably the easiest solution).</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-34-contents" aria-controls="callout-34" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-34" class="callout-34-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's pick out individual names of the archaics</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>archaics <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Vindija33.19"</span>, <span class="st">"AltaiNeandertal"</span>, <span class="st">"Denisova"</span>)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">set =</span> <span class="fu">case_when</span>(</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="dv">0</span>             <span class="sc">~</span> <span class="st">"Modern"</span>,  <span class="co"># whoever has sampling date 0 is "Modern"</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>    sample <span class="sc">%in%</span> archaics <span class="sc">~</span> <span class="st">"Archaic"</span>, <span class="co"># whoever is among archaics is "Archaic"</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default             =</span> <span class="st">"Ancient"</span>  <span class="co"># and only the third category remains</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">.after =</span> coverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Note the use of <code>.after =</code> in my solution to the previous exercise. Look up the help of <code>mutate()</code> in <code>?mutate</code> to see what it does and why I used it.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Usually, when we add a new column using <code>mutate()</code> we don’t want to add it to the very end of the table (where we cannot see it), which is what the function does by default. <code>.after</code> and <code>.before</code> are options which allow us to specify where among the already present columns in the data frame do we want to add the new column</p>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-12-summarizing-tables" class="level2">
<h2 class="anchored" data-anchor-id="exercise-12-summarizing-tables">Exercise 12: Summarizing tables</h2>
<p>You have already learned how to operate on rows (<code>filter()</code>, <code>arrange()</code>), columns (<code>select()</code>, <code>rename()</code>), and both (<code>mutate()</code>). We have one remaining piece of the puzzle and that is operating on <em>groups of rows</em>. This takes the <em>tidyverse</em> functionality to an entire whole level and allows you to do many more powerful things with tabular data and compute summary statistics. In this section, we will will cover the functions <code>group_by()</code>, <code>summarize()</code>, and various associated “slice functions”.</p>
<section id="group_by" class="level3">
<h3 class="anchored" data-anchor-id="group_by">1. <code>group_by()</code></h3>
<p><strong>Take a look at the first couple of rows of our data again:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 26
   sample  population country continent   age coverage set    site  region    
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     
 1 NA18486 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 2 NA18488 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 3 NA18489 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 4 NA18498 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 5 NA18499 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 6 NA18501 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 7 NA18502 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 8 NA18504 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 9 NA18505 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
10 NA18507 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
# ℹ 4,062 more rows
# ℹ 17 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;, sex_desc &lt;chr&gt;, sex_set &lt;chr&gt;</code></pre>
</div>
</div>
<p><strong>Now run the following code in your R console and carefully inspect the output (and compare it to the result of the previous command):</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(df, continent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 26
# Groups:   continent [4]
   sample  population country continent   age coverage set    site  region    
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     
 1 NA18486 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 2 NA18488 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 3 NA18489 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 4 NA18498 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 5 NA18499 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 6 NA18501 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 7 NA18502 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 8 NA18504 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 9 NA18505 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
10 NA18507 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
# ℹ 4,062 more rows
# ℹ 17 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;, sex_desc &lt;chr&gt;, sex_set &lt;chr&gt;</code></pre>
</div>
</div>
<p>You can probably see that the data hasn’t changed at all (same number of columns, same number of rows, all remains the same), but you can notice a new piece of information in the output:</p>
<pre><code>[...]
# Groups:   continent [4]
[...]</code></pre>
<p>The output says that the data has been grouped by the column/variable continent. This means that any subsequent operation will be applied not to individual rows, like it was with our <code>mutate()</code> operations earlier, but they will now work “per continent”. You can imagine this as the <code>group_by()</code> function adding a tiny bit of invisible annotation data which instructs downstream functions to work per group.</p>
<p>Before we move on to computing summary statistics, let’s also note that we can, of course, group based on multiple columns. For instance, in our data, we should probably not summarize based on continent but also on age, splitting individuals based on the broad age sets like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(df, continent, set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,072 × 26
# Groups:   continent, set [10]
   sample  population country continent   age coverage set    site  region    
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     
 1 NA18486 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 2 NA18488 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 3 NA18489 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 4 NA18498 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 5 NA18499 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 6 NA18501 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 7 NA18502 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 8 NA18504 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
 9 NA18505 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
10 NA18507 YRI        Nigeria Africa        0       NA Modern &lt;NA&gt;  WestAfrica
# ℹ 4,062 more rows
# ℹ 17 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;, sex_desc &lt;chr&gt;, sex_set &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="summarize" class="level3">
<h3 class="anchored" data-anchor-id="summarize">2. <code>summarize()</code></h3>
<p>Why is grouping introduced above even useful? The most simple use case is computing summary statistics on the data on a “per group” basis using the <code>summarize()</code> functions. This function works a little bit like <code>mutate()</code>, because it creates new columns, but it only creates one row for each group.</p>
<p>For instance, we could compute the mean coverage of each individual in a group like this, and arrange the groups by the coverage available:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, set) <span class="sc">%&gt;%</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_coverage =</span> <span class="fu">mean</span>(coverage))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
# Groups:   continent [4]
   continent set     mean_coverage
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
 1 Africa    Ancient          4.99
 2 Africa    Modern          NA   
 3 America   Ancient          2.67
 4 America   Modern          NA   
 5 Asia      Ancient          1.71
 6 Asia      Archaic         35.3 
 7 Asia      Modern          NA   
 8 Europe    Ancient          1.41
 9 Europe    Archaic         24.4 
10 Europe    Modern          NA   </code></pre>
</div>
</div>
<p>Notice that the result has only three columns, unlike the many columns in the original <code>df</code> table! We have a column for each variable we grouped over, and we have the new column with our summary statistic. Additionally, we only have 10 rows, one row for each combination of <code>continent</code> and <code>set</code>.</p>
<hr>
<p><strong>What does the <code>NA</code> value for “Modern” individuals in the output of the previous code chunk? Take a look at the original data <code>df</code> to answer this question.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-36-contents" aria-controls="callout-36" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-36" class="callout-36-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The reason is simple – the present-day individuals are high quality imputed genotypes, which is why the sequencing coverage column is full of <code>NA</code> (not available, i.e., missing data) values. Computing a mean of such values is, itself, an <code>NA</code> value too:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><code>summarize()</code> is even more powerful than that because we can compute many different things at the same time, for each group! The next exercise is an example of that.</p>
<p><strong>As you know, the mean (such as the <code>mean_coverage</code> we computed right above) is computed as a sum of a set of values divided by their count. Use the <code>group_by()</code> and <code>summarize()</code> code like we used above, but instead of computing the <code>mean()</code> directly, compute it manually by doing (in a <code>summarize()</code> call):</strong></p>
<ol type="1">
<li><code>sum_coverage = sum(coverage)</code> (the sum of coverages for each group),</li>
<li><code>n = n()</code> (the number of values in each group),</li>
<li><code>mean_coverage = sum_coverage / n</code> (using the two quantities just computed to calculate the mean)</li>
</ol>
<p><strong>To make things a little tidier, <code>arrange()</code> the results by the column <code>mean_coverage</code>.</strong></p>
<p><strong>Once you have your results, save this new table in a variable called <code>df_summary</code>.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-37-contents" aria-controls="callout-37" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-37" class="callout-37-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Here’s our entire pipeline to compute the mean coverage “manually” instead of the built-in function <code>mean()</code> like we did in the previous exercise:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>df_summary <span class="ot">&lt;-</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span>                               <span class="co"># take the data frame df...</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, set) <span class="sc">%&gt;%</span>         <span class="co"># ... group rows on continent and set...</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(                           <span class="co"># ... and compute for each group:</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_coverage =</span> <span class="fu">sum</span>(coverage),      <span class="co">#       1. the sum of all coverage</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),                           <span class="co">#       2. the number of coverages</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_coverage =</span> sum_coverage <span class="sc">/</span> n   <span class="co">#       3. the mean using 1. and 2.above</span></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean_coverage)               <span class="co"># ... then sort by average coverage</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>df_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
# Groups:   continent [4]
   continent set     sum_coverage     n mean_coverage
   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;int&gt;         &lt;dbl&gt;
 1 Europe    Ancient       1722.   1220          1.41
 2 Asia      Ancient        600.    350          1.71
 3 America   Ancient        205.     77          2.67
 4 Africa    Ancient         84.8    17          4.99
 5 Europe    Archaic         24.4     1         24.4 
 6 Asia      Archaic         70.6     2         35.3 
 7 Africa    Modern          NA     504         NA   
 8 America   Modern          NA     504         NA   
 9 Asia      Modern          NA     993         NA   
10 Europe    Modern          NA     404         NA   </code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Look up the function <code>?ungroup</code>. Why is it useful?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-38-contents" aria-controls="callout-38" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-38" class="callout-38-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Although grouping is very useful for computing summary statistics across groups of values, we often need to discard the grouping because we might want to continue working with the summarized table we obtained with other <em>tidyverse</em> functions without working on the pre-defined groups. For instance, we might want to follow up a <code>summarize()</code> operation with a <code>mutate()</code> operation, without working with groups.</p>
</div>
</div>
</div>
<hr>
</section>
<section id="slice_-functions" class="level3">
<h3 class="anchored" data-anchor-id="slice_-functions"><code>slice_</code> functions</h3>
<p>We have five “slicing” functions at our disposal, each of which extracts specific row(s) from each defined group. These functions are:</p>
<ul>
<li><code>slice_head(n = 1)</code> takes the first row,</li>
<li><code>slice_tail(n = 1)</code> takes the last row,</li>
<li><code>slice_min(&lt;column&gt;, n = 1)</code> takes the row with the smallest value of <column>,</column></li>
<li><code>slice_max(&lt;column&gt;, n = 1)</code> takes the row with the largest value of <column>,</column></li>
<li><code>slice_sample(&lt;col&gt; = 1)</code> takes one random row.</li>
</ul>
<hr>
<p><strong>What is the lowest coverage individual in each group? While you’re doing this, <code>filter()</code> out the <code>set</code> of “Modern” individuals because they are not meaningful anyway (they have <code>NA</code> coverages). At the end of your <code>%&gt;%</code> pipeline, pipe your results into <code>relocate(continent, set)</code> to make everything even tidier. Look up <code>?relocate</code> to find out what this function does, if you’re not sure from the output.</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-39-contents" aria-controls="callout-39" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-39" class="callout-39-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(set <span class="sc">!=</span> <span class="st">"Modern"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, set) <span class="sc">%&gt;%</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(coverage, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(continent, set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 26
# Groups:   continent, set [6]
  continent set     sample       population country    age coverage site  region
  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Africa    Ancient gun002       gun002     Canary…   860.   0.213  Tene… North…
2 America   Ancient AM71         AM71       Chile     100    0.103  Stra… South…
3 Asia      Ancient NEO916       NEO916     Russia   5727    0.0175 Veng… North…
4 Asia      Archaic Denisova     Denisova   Russia  80000   25.8    Deni… North…
5 Europe    Ancient NEO496       NEO496     Ukraine 10655    0.0124 Vasi… Centr…
6 Europe    Archaic Vindija33.19 Vindija33… Croatia 41950   24.4    Vind… Centr…
# ℹ 17 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;, sex_desc &lt;chr&gt;, sex_set &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>Who is the oldest individual we have available on each continent?</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-40-contents" aria-controls="callout-40" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-40" class="callout-40-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(set <span class="sc">!=</span> <span class="st">"Modern"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(continent, set, age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 26
# Groups:   continent [4]
  continent set        age sample       population country coverage site  region
  &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Africa    Ancient   7885 I10871       I10871     Camero…     15.2 Shum… Centr…
2 America   Ancient  12649 Clovis       Clovis     USA         15.1 Mont… North…
3 Asia      Archaic 125000 AltaiNeande… AltaiNean… Russia      44.8 Deni… North…
4 Europe    Archaic  41950 Vindija33.19 Vindija33… Croatia     24.4 Vind… Centr…
# ℹ 17 more variables: groupLabel &lt;chr&gt;, flag &lt;chr&gt;, latitude &lt;dbl&gt;,
#   longitude &lt;dbl&gt;, dataSource &lt;chr&gt;, age14C &lt;dbl&gt;, ageHigh &lt;dbl&gt;,
#   ageLow &lt;dbl&gt;, datingSource &lt;chr&gt;, sex &lt;chr&gt;, hgMT &lt;chr&gt;, gpAvg &lt;dbl&gt;,
#   ageRaw &lt;chr&gt;, hgYMajor &lt;chr&gt;, hgYMinor &lt;chr&gt;, sex_desc &lt;chr&gt;, sex_set &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-13-writing-and-reading-tables" class="level2">
<h2 class="anchored" data-anchor-id="exercise-13-writing-and-reading-tables">Exercise 13: Writing (and reading) tables</h2>
<p>Now that we have our results stored in <code>df_summary</code>, let’s try writing them to disk using <code>write_tsv()</code>. The <code>.tsv</code> stands for “tab-separated values” (TSV) which is a file format similar to another file you might have heard about, the “comma-separated values” (CSV) file.</p>
<hr>
<p><strong>Look up the help in <code>?write_tsv</code>. What are the parameters you need to specify at minimum to save the file? This function has all of the useful options saved as defaults, so there’s not much you have to do. Still, look up the options!</strong></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-41-contents" aria-controls="callout-41" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-41" class="callout-41-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The only thing we really want to do is specify the data frame to write to disk and the filename:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_tsv</span>(df_summary, <span class="st">"~/Desktop/df_summary.tsv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
<p><strong>What are other means of writing files you found in <code>?write_tsv</code>? How would you read a CSV file into R? What about other file formats?</strong></p>
<p><strong>Hint:</strong> Look up <code>?read_csv</code>.</p>
</section>
<section id="exercise-14-some-questions-about-the-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-14-some-questions-about-the-data">Exercise 14: Some questions about the data</h2>
<p><strong>Which country has the highest number of aDNA samples (i.e., samples for which <code>set == "Ancient</code>“). How many samples from Estonia, Lithuania, or Latvia do we have?</strong></p>
<p><strong>Hint:</strong> Use the <code>group_by(country)</code> and <code>summarize()</code> combo again, together with the <code>n()</code> helper function.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-42-contents" aria-controls="callout-42" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-42" class="callout-42-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Count the number of samples from each country, and order them by this count:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>countries_df <span class="ot">&lt;-</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(set <span class="sc">==</span> <span class="st">"Ancient"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>countries_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 58 × 2
   country        n
   &lt;chr&gt;      &lt;int&gt;
 1 Russia       283
 2 Denmark      184
 3 Sweden       174
 4 Italy        149
 5 UK            76
 6 Kazakhstan    64
 7 Estonia       60
 8 Ukraine       60
 9 Poland        56
10 France        54
# ℹ 48 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>countries_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Estonia"</span>, <span class="st">"Lithuania"</span>, <span class="st">"Latvia"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  country       n
  &lt;chr&gt;     &lt;int&gt;
1 Estonia      60
2 Latvia        7
3 Lithuania     1</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-43-contents" aria-controls="callout-43" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-43" class="callout-43-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Is there evidence of a potential bias in terms of how many samples do we have from a country and the geographical location of that country, such as the average longitude or latitude of samples from there?</strong></p>
<p><strong>Hint:</strong> Count the <code>n</code> count of samples from each country using <code>group_by()</code> and <code>sumarize()</code> again, like you did above, and compute also the <code>avg_lat</code> and <code>avg_lon</code> (average latitude and longitude) of samples in each country.**</p>
<p><strong>Hint:</strong> Look up the linear model function <code>?lm</code> or perhaps <a href="https://www.geeksforgeeks.org/r-language/how-to-use-lm-function-in-r-to-fit-linear-models/">this tutorial</a> to see how you can build a linear regression between a response variable (like our count <code>n</code>) and an explanatory variable (such as average longitude or latitude of a country).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>countries_df <span class="ot">&lt;-</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(set <span class="sc">==</span> <span class="st">"Ancient"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_lat =</span> <span class="fu">mean</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_lon =</span> <span class="fu">mean</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>countries_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 58 × 4
   country            n avg_lat avg_lon
   &lt;chr&gt;          &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 Argentina          5  -50.2    -69.5
 2 Armenia            6   40.1     45.3
 3 Brazil             5  -19.5    -43.9
 4 Cameroon           2    5.86    10.1
 5 Canada             6   47.0    -94.1
 6 Canary Islands     5   28.2    -16.2
 7 Chile              4  -52.7    -72.9
 8 China              7   43.6     93.2
 9 CzechRepublic      9   49.9     15.0
10 Denmark          184   55.6     11.0
# ℹ 48 more rows</code></pre>
</div>
</div>
<p>Compute the linear regression of <code>n</code> as a function of <code>avg_lon</code> – there doesn’t appear to be any significant relationship between the two variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>lm_res <span class="ot">&lt;-</span> <span class="fu">lm</span>(n <span class="sc">~</span> avg_lon, <span class="at">data =</span> countries_df)</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = n ~ avg_lon, data = countries_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-27.785 -24.543 -21.474   7.008 254.543 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 28.822477   7.431781   3.878 0.000279 ***
avg_lon     -0.005886   0.123753  -0.048 0.962235    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 52.45 on 56 degrees of freedom
Multiple R-squared:  4.039e-05, Adjusted R-squared:  -0.01782 
F-statistic: 0.002262 on 1 and 56 DF,  p-value: 0.9622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(countries_df<span class="sc">$</span>avg_lon, countries_df<span class="sc">$</span>n)</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tidy-basics_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Compute the linear regression of <code>n</code> as a function of <code>avg_lat</code> – it looks like there’s a significant relationship between the number of samples from a country and geographical latitude? Is this a signal of aDNA surviving in more colder climates? :)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>lm_res <span class="ot">&lt;-</span> <span class="fu">lm</span>(n <span class="sc">~</span> avg_lat, <span class="at">data =</span> countries_df)</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = n ~ avg_lat, data = countries_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-41.085 -28.042 -13.834   7.972 242.851 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)   8.2158    10.9508   0.750    0.456  
avg_lat       0.5848     0.2501   2.338    0.023 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 50.07 on 56 degrees of freedom
Multiple R-squared:  0.08891,   Adjusted R-squared:  0.07264 
F-statistic: 5.465 on 1 and 56 DF,  p-value: 0.023</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(countries_df<span class="sc">$</span>avg_lat, countries_df<span class="sc">$</span>n)</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tidy-basics_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-15-tidyverse-aware-functions" class="level2">
<h2 class="anchored" data-anchor-id="exercise-15-tidyverse-aware-functions">Exercise 15: <em>tidyverse</em>-aware functions</h2>
<p>TODO (maybe)</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./r-bootcamp.html" class="pagination-link" aria-label="R bootcamp">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">R bootcamp</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./tidy-advanced.html" class="pagination-link" aria-label="Practical processing techniques">
        <span class="nav-page-text"><span class="chapter-title">Practical processing techniques</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>